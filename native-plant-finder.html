<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Native Plant Finder — Ben Siverly</title>
  <meta name="description" content="Find native plants that thrive in your area with minimal effort. Support local pollinators, birds, and beneficial insects while reducing water and maintenance.">

  <!-- Open Graph -->
  <meta property="og:title" content="Native Plant Finder — Ben Siverly">
  <meta property="og:description" content="Find native plants that thrive in your area. Support local pollinators and reduce maintenance.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://bensiverly.com/native-plant-finder.html">
  <meta property="og:image" content="https://bensiverly.com/images/og-native-plant-finder.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Native Plant Finder — Ben Siverly">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Native Plant Finder — Ben Siverly">
  <meta name="twitter:description" content="Find native plants that thrive in your area. Support local pollinators and reduce maintenance.">
  <meta name="twitter:image" content="https://bensiverly.com/images/og-native-plant-finder.png">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,500;0,9..144,600;0,9..144,700;1,9..144,400&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /* ==========================================================================
       CSS Variables - California Native Palette
       ========================================================================== */
    :root {
      /* Primary colors - drawn from California native plants */
      --color-sage: #7C9082;
      --color-cream: #F5F2EB;
      --color-earth: #8B7355;

      /* Accent colors */
      --color-poppy: #E8A849;
      --color-manzanita: #C4A4A4;
      --color-bay-deep: #2D4739;

      /* Neutrals */
      --color-charcoal: #3A3A3A;
      --color-stone: #B8B2A7;
      --color-off-white: #FAFAF8;

      /* Semantic mappings */
      --color-bg: var(--color-off-white);
      --color-bg-alt: var(--color-cream);
      --color-text: var(--color-charcoal);
      --color-accent: var(--color-poppy);
      --color-accent-hover: #D4952F;
      --color-muted: #6B6560;
      --color-border: #DDD8D0;

      /* Plant layer colors - nature-inspired */
      --color-canopy: #2D4739;
      --color-small-tree: #3D6349;
      --color-tall-shrub: #4D7A59;
      --color-low-shrub: #6B9472;
      --color-ground: #89AE8E;

      /* Water level colors */
      --color-water-very-low: #B4D4E7;
      --color-water-low: #7BB8D6;
      --color-water-moderate: #4A9BC5;

      /* Wildlife tag colors */
      --color-wildlife: #D4A76A;
      --color-wildlife-subtle: #F5EBD9;

      /* Care level colors */
      --color-easy: #7C9082;
      --color-moderate-care: #B8B2A7;

      --font-heading: 'Fraunces', Georgia, serif;
      --font-body: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --font-mono: 'Inter', -apple-system, sans-serif;

      --space-xs: 0.5rem;
      --space-sm: 1rem;
      --space-md: 1.5rem;
      --space-lg: 2.5rem;
      --space-xl: 4rem;

      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;

      --transition-fast: 150ms ease;
      --transition-base: 250ms ease;
      --transition-slow: 400ms cubic-bezier(0.4, 0, 0.2, 1);

      /* Shadows */
      --shadow-sm: 0 1px 3px rgba(59, 56, 51, 0.08);
      --shadow-md: 0 4px 12px rgba(59, 56, 51, 0.1);
      --shadow-lg: 0 8px 24px rgba(59, 56, 51, 0.12);
      --shadow-lift: 0 8px 24px rgba(59, 56, 51, 0.15);
    }

    /* ==========================================================================
       Base Styles
       ========================================================================== */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    html {
      font-size: 16px;
      -webkit-text-size-adjust: 100%;
    }

    body {
      margin: 0;
      font-family: var(--font-body);
      font-size: 1rem;
      line-height: 1.7;
      color: var(--color-text);
      background-color: var(--color-bg);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      /* Subtle paper texture */
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      background-blend-mode: overlay;
      background-size: 200px 200px;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, rgba(245, 242, 235, 0.3) 0%, rgba(250, 250, 248, 0) 50%);
      pointer-events: none;
      z-index: -1;
    }

    /* ==========================================================================
       Header
       ========================================================================== */
    .site-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-sm) var(--space-md);
      border-bottom: 1px solid var(--color-border);
      background: rgba(250, 250, 248, 0.8);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .site-brand {
      font-family: var(--font-heading);
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--color-bay-deep);
      text-decoration: none;
      transition: color var(--transition-fast);
    }

    .site-brand:hover {
      color: var(--color-sage);
    }

    .header-meta {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .tool-label {
      font-family: var(--font-body);
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.02em;
      color: var(--color-sage);
    }

    .reset-link {
      font-family: var(--font-body);
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--color-muted);
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.375rem 0.75rem;
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
      opacity: 0;
      pointer-events: none;
    }

    .reset-link.is-visible {
      opacity: 1;
      pointer-events: auto;
    }

    .reset-link:hover {
      color: var(--color-text);
      background-color: var(--color-bg-alt);
    }

    /* ==========================================================================
       Main Container
       ========================================================================== */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 720px;
      width: 100%;
      margin: 0 auto;
      padding: var(--space-lg) var(--space-md);
    }

    /* ==========================================================================
       Tool Container
       ========================================================================== */
    .tool {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    /* ==========================================================================
       Input Section
       ========================================================================== */
    .input-section {
      margin-bottom: var(--space-lg);
      text-align: center;
      padding: var(--space-lg) 0;
    }

    .input-header {
      margin-bottom: var(--space-lg);
    }

    .input-title {
      font-family: var(--font-heading);
      font-size: 2.25rem;
      font-weight: 600;
      margin: 0 0 var(--space-xs) 0;
      color: var(--color-bay-deep);
      letter-spacing: -0.01em;
    }

    .input-tagline {
      font-family: var(--font-heading);
      font-size: 1.125rem;
      font-weight: 400;
      font-style: italic;
      color: var(--color-sage);
      margin: 0 0 var(--space-sm) 0;
    }

    .input-subtitle {
      font-size: 0.9375rem;
      color: var(--color-muted);
      margin: 0;
      max-width: 480px;
      margin-left: auto;
      margin-right: auto;
    }

    .input-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-lg);
      max-width: 560px;
      margin: 0 auto;
      text-align: left;
    }

    @media (max-width: 520px) {
      .input-grid {
        grid-template-columns: 1fr;
      }
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    .input-label {
      font-family: var(--font-body);
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--color-text);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .input-label-icon {
      width: 18px;
      height: 18px;
      color: var(--color-sage);
    }

    .input-text {
      font-family: var(--font-body);
      font-size: 1.125rem;
      padding: 0.875rem 1rem;
      border: 2px solid var(--color-border);
      border-radius: var(--radius-md);
      background: white;
      color: var(--color-text);
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-sm);
    }

    .input-text:focus {
      outline: none;
      border-color: var(--color-sage);
      box-shadow: 0 0 0 3px rgba(124, 144, 130, 0.15);
    }

    .input-text.is-invalid {
      border-color: #C53030;
    }

    .input-text.is-invalid:focus {
      box-shadow: 0 0 0 3px rgba(197, 48, 48, 0.15);
    }

    .input-help {
      font-size: 0.8125rem;
      color: var(--color-muted);
    }

    .input-error {
      font-size: 0.8125rem;
      color: #C53030;
      display: none;
    }

    .input-error.is-visible {
      display: block;
    }

    /* Location Display */
    .location-display {
      display: none;
      align-items: center;
      gap: 0.5rem;
      padding: 0.875rem 1rem;
      background: var(--color-cream);
      border-radius: var(--radius-md);
      border: 2px solid transparent;
    }

    .location-display.is-visible {
      display: flex;
    }

    .location-name {
      font-weight: 500;
      color: var(--color-text);
    }

    .location-change {
      font-size: 0.8125rem;
      color: var(--color-sage);
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      margin-left: auto;
    }

    .location-change:hover {
      color: var(--color-bay-deep);
      text-decoration: underline;
    }

    /* Sun Slider */
    .sun-slider-container {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .sun-slider-value {
      font-family: var(--font-body);
      font-size: 1rem;
      font-weight: 500;
      color: var(--color-text);
      min-height: 1.5rem;
    }

    .sun-slider-track {
      position: relative;
      width: 100%;
      padding: 0.75rem 0;
    }

    .sun-slider-visual {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-bottom: 0.5rem;
      padding: 0 0.25rem;
    }

    .sun-icon {
      width: 24px;
      height: 24px;
      color: var(--color-stone);
      transition: all var(--transition-fast);
    }

    .sun-icon.is-active {
      color: var(--color-poppy);
      transform: scale(1.1);
    }

    .sun-slider-input {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 8px;
      background: linear-gradient(to right,
        var(--color-sage) 0%,
        var(--color-stone) 33%,
        var(--color-poppy) 66%,
        #E8A849 100%
      );
      border-radius: 4px;
      outline: none;
      cursor: pointer;
    }

    .sun-slider-input::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      background: white;
      border-radius: 50%;
      cursor: grab;
      border: 3px solid var(--color-bay-deep);
      box-shadow: var(--shadow-md);
      transition: all var(--transition-fast);
    }

    .sun-slider-input::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-lg);
    }

    .sun-slider-input::-webkit-slider-thumb:active {
      cursor: grabbing;
    }

    .sun-slider-input::-moz-range-thumb {
      width: 28px;
      height: 28px;
      background: white;
      border-radius: 50%;
      cursor: grab;
      border: 3px solid var(--color-bay-deep);
      box-shadow: var(--shadow-md);
    }

    .sun-slider-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 0.5rem;
    }

    .sun-slider-label {
      font-size: 0.75rem;
      color: var(--color-muted);
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .sun-slider-label svg {
      width: 14px;
      height: 14px;
    }

    /* Find Plants Button */
    .find-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.625rem;
      font-family: var(--font-body);
      font-size: 1rem;
      font-weight: 600;
      padding: 1rem 2rem;
      border: none;
      background: var(--color-bay-deep);
      color: white;
      cursor: pointer;
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
      margin-top: var(--space-lg);
      box-shadow: var(--shadow-md);
    }

    .find-btn:hover {
      background: var(--color-sage);
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
    }

    .find-btn:active {
      transform: translateY(0);
    }

    .find-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .find-btn svg {
      width: 20px;
      height: 20px;
    }

    /* ==========================================================================
       Results Section
       ========================================================================== */
    .results-section {
      opacity: 1;
      transition: opacity var(--transition-base);
    }

    .results-section.is-hidden {
      display: none;
    }

    .results-section.is-transitioning {
      opacity: 0;
    }

    .results-header {
      margin-bottom: var(--space-lg);
      text-align: center;
      padding-bottom: var(--space-md);
      border-bottom: 1px solid var(--color-border);
    }

    .results-title {
      font-family: var(--font-heading);
      font-size: 1.75rem;
      font-weight: 600;
      margin: 0 0 var(--space-xs) 0;
      color: var(--color-bay-deep);
    }

    .results-meta {
      font-size: 0.9375rem;
      color: var(--color-muted);
      margin: 0;
    }

    .region-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-family: var(--font-body);
      font-size: 0.8125rem;
      font-weight: 500;
      padding: 0.5rem 1rem;
      background: var(--color-cream);
      border-radius: var(--radius-md);
      margin-top: var(--space-sm);
      color: var(--color-text);
    }

    .region-badge svg {
      width: 16px;
      height: 16px;
      color: var(--color-sage);
    }

    /* Filter Section */
    .filter-section {
      margin-bottom: var(--space-md);
      padding: var(--space-md);
      background: var(--color-cream);
      border-radius: var(--radius-md);
    }

    .filter-title {
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--color-text);
      margin: 0 0 var(--space-sm) 0;
    }

    .filter-groups {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-md);
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
    }

    .filter-group-label {
      font-size: 0.6875rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-muted);
    }

    .filter-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 0.375rem;
    }

    .filter-pill {
      font-family: var(--font-body);
      font-size: 0.8125rem;
      padding: 0.375rem 0.75rem;
      border: 1px solid var(--color-border);
      background: white;
      border-radius: 20px;
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .filter-pill:hover {
      border-color: var(--color-sage);
    }

    .filter-pill.is-active {
      background: var(--color-bay-deep);
      border-color: var(--color-bay-deep);
      color: white;
    }

    .filter-pill svg {
      width: 14px;
      height: 14px;
    }

    .filter-summary {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: var(--space-sm);
      padding-top: var(--space-sm);
      border-top: 1px solid rgba(0,0,0,0.06);
    }

    .filter-count {
      font-size: 0.875rem;
      color: var(--color-muted);
    }

    .filter-count strong {
      color: var(--color-text);
      font-weight: 600;
    }

    .filter-clear {
      font-size: 0.8125rem;
      color: var(--color-sage);
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
    }

    .filter-clear:hover {
      color: var(--color-bay-deep);
      text-decoration: underline;
    }

    /* ==========================================================================
       Layer Overview (Simplified landscape visualization)
       ========================================================================== */
    .layers-overview {
      margin-bottom: var(--space-lg);
      padding: var(--space-md);
      background: linear-gradient(135deg, var(--color-cream) 0%, rgba(245, 242, 235, 0.5) 100%);
      border-radius: var(--radius-lg);
      border: 1px solid var(--color-border);
    }

    .layers-overview-title {
      font-family: var(--font-heading);
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--color-text);
      margin: 0 0 var(--space-sm) 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .layers-overview-title svg {
      width: 18px;
      height: 18px;
      color: var(--color-sage);
    }

    .layers-stack {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .layer-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.625rem 0.75rem;
      background: white;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .layer-row:hover {
      background: rgba(255, 255, 255, 0.9);
      transform: translateX(4px);
    }

    .layer-indicator {
      width: 4px;
      border-radius: 2px;
      flex-shrink: 0;
    }

    .layer-indicator--canopy { background: var(--color-canopy); height: 32px; }
    .layer-indicator--small-tree { background: var(--color-small-tree); height: 26px; }
    .layer-indicator--tall-shrub { background: var(--color-tall-shrub); height: 20px; }
    .layer-indicator--low-shrub { background: var(--color-low-shrub); height: 14px; }
    .layer-indicator--ground { background: var(--color-ground); height: 8px; }

    .layer-info {
      flex: 1;
      min-width: 0;
    }

    .layer-name {
      font-weight: 500;
      font-size: 0.875rem;
      color: var(--color-text);
    }

    .layer-meta {
      font-size: 0.75rem;
      color: var(--color-muted);
    }

    .layer-count {
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--color-sage);
      white-space: nowrap;
    }

    /* ==========================================================================
       Plant Cards
       ========================================================================== */
    .plants-section {
      margin-bottom: var(--space-lg);
    }

    .plants-category {
      margin-bottom: var(--space-xl);
    }

    .category-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: var(--space-md);
      padding: var(--space-sm) var(--space-md);
      background: var(--color-cream);
      border-radius: var(--radius-md);
      position: sticky;
      top: 60px;
      z-index: 10;
    }

    .category-header-content {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .category-title {
      font-family: var(--font-heading);
      font-size: 1.125rem;
      font-weight: 600;
      margin: 0;
      color: var(--color-bay-deep);
    }

    .category-subtitle {
      font-size: 0.8125rem;
      color: var(--color-muted);
      font-style: italic;
    }

    .category-meta {
      font-size: 0.8125rem;
      color: var(--color-sage);
      font-weight: 500;
      white-space: nowrap;
    }

    .plants-grid {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .plant-card {
      background: white;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      overflow: hidden;
      transition: all var(--transition-fast);
      cursor: pointer;
      display: flex;
      flex-direction: row;
    }

    .plant-card:hover {
      border-color: var(--color-sage);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .plant-card.is-expanded {
      border-color: var(--color-bay-deep);
      box-shadow: var(--shadow-lg);
    }

    /* Plant Image/Placeholder */
    .plant-image-container {
      width: 120px;
      min-height: 140px;
      flex-shrink: 0;
      position: relative;
      overflow: hidden;
    }

    .plant-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .plant-placeholder--canopy_tree { background: linear-gradient(135deg, var(--color-canopy) 0%, #1E3326 100%); }
    .plant-placeholder--small_tree { background: linear-gradient(135deg, var(--color-small-tree) 0%, var(--color-canopy) 100%); }
    .plant-placeholder--tall_shrub { background: linear-gradient(135deg, var(--color-tall-shrub) 0%, var(--color-small-tree) 100%); }
    .plant-placeholder--low_shrub { background: linear-gradient(135deg, var(--color-low-shrub) 0%, var(--color-tall-shrub) 100%); }
    .plant-placeholder--ground_cover { background: linear-gradient(135deg, var(--color-ground) 0%, var(--color-low-shrub) 100%); }

    .plant-placeholder-icon {
      width: 48px;
      height: 48px;
      color: rgba(255, 255, 255, 0.4);
    }

    .plant-bloom-badge {
      position: absolute;
      bottom: 8px;
      left: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      font-size: 0.6875rem;
      font-weight: 500;
    }

    .plant-bloom-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    /* Plant Content */
    .plant-content {
      flex: 1;
      padding: var(--space-md);
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    .plant-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--space-sm);
      margin-bottom: 0.5rem;
    }

    .plant-name-group {
      min-width: 0;
    }

    .plant-name {
      font-family: var(--font-heading);
      font-size: 1.0625rem;
      font-weight: 600;
      margin: 0;
      line-height: 1.3;
      color: var(--color-text);
    }

    .plant-scientific {
      font-size: 0.8125rem;
      font-style: italic;
      color: var(--color-muted);
      margin: 0.125rem 0 0 0;
    }

    /* Favorite Button */
    .plant-favorite {
      flex-shrink: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      background: var(--color-cream);
      border-radius: 50%;
      cursor: pointer;
      transition: all var(--transition-fast);
      color: var(--color-stone);
    }

    .plant-favorite:hover {
      background: var(--color-manzanita);
      color: white;
    }

    .plant-favorite.is-favorited {
      background: var(--color-manzanita);
      color: white;
    }

    .plant-favorite svg {
      width: 16px;
      height: 16px;
    }

    /* Tag Groups */
    .plant-tags-grouped {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: auto;
    }

    .tag-group {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    /* Water Tags */
    .plant-tag {
      font-size: 0.6875rem;
      font-weight: 500;
      padding: 0.25rem 0.5rem;
      border-radius: 12px;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    .plant-tag svg {
      width: 12px;
      height: 12px;
    }

    .plant-tag--water-very-low {
      background: var(--color-water-very-low);
      color: #1E5A7C;
    }

    .plant-tag--water-low {
      background: var(--color-water-low);
      color: #0F3D54;
    }

    .plant-tag--water-moderate {
      background: var(--color-water-moderate);
      color: white;
    }

    /* Wildlife Tags */
    .plant-tag--wildlife {
      background: var(--color-wildlife-subtle);
      color: #8B6914;
    }

    /* Care Tags */
    .plant-tag--easy {
      background: rgba(124, 144, 130, 0.15);
      color: var(--color-bay-deep);
    }

    .plant-tag--deer {
      background: rgba(139, 115, 85, 0.12);
      color: var(--color-earth);
    }

    /* Plant Details (Expanded) */
    .plant-details {
      display: none;
      padding-top: var(--space-sm);
      border-top: 1px solid var(--color-border);
      margin-top: var(--space-sm);
    }

    .plant-card.is-expanded .plant-details {
      display: block;
      animation: slideDown 0.2s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .plant-description {
      font-size: 0.875rem;
      line-height: 1.7;
      color: var(--color-muted);
      margin: 0 0 var(--space-sm) 0;
    }

    .plant-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-sm);
      background: var(--color-cream);
      padding: var(--space-sm);
      border-radius: var(--radius-sm);
    }

    .plant-stat {
      display: flex;
      flex-direction: column;
      gap: 0.125rem;
    }

    .stat-label {
      font-size: 0.6875rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      color: var(--color-muted);
    }

    .stat-value {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--color-text);
    }

    .plant-link {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      margin-top: var(--space-sm);
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--color-sage);
      text-decoration: none;
      transition: color var(--transition-fast);
    }

    .plant-link:hover {
      color: var(--color-bay-deep);
    }

    .plant-link svg {
      width: 14px;
      height: 14px;
    }

    /* Mobile: Stack vertically */
    @media (max-width: 520px) {
      .plant-card {
        flex-direction: column;
      }

      .plant-image-container {
        width: 100%;
        min-height: 120px;
      }
    }

    /* ==========================================================================
       My Garden (Favorites) Section
       ========================================================================== */
    .my-garden-section {
      margin-bottom: var(--space-lg);
      padding: var(--space-md);
      background: linear-gradient(135deg, rgba(196, 164, 164, 0.15) 0%, rgba(232, 168, 73, 0.1) 100%);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(196, 164, 164, 0.3);
    }

    .my-garden-section.is-hidden {
      display: none;
    }

    .my-garden-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-sm);
    }

    .my-garden-title {
      font-family: var(--font-heading);
      font-size: 1rem;
      font-weight: 600;
      margin: 0;
      color: var(--color-text);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .my-garden-title svg {
      width: 18px;
      height: 18px;
      color: var(--color-manzanita);
    }

    .my-garden-count {
      font-size: 0.8125rem;
      color: var(--color-muted);
    }

    .my-garden-plants {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .my-garden-plant {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: white;
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      font-weight: 500;
    }

    .my-garden-plant-remove {
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      background: var(--color-cream);
      border-radius: 50%;
      cursor: pointer;
      color: var(--color-muted);
      transition: all var(--transition-fast);
    }

    .my-garden-plant-remove:hover {
      background: var(--color-manzanita);
      color: white;
    }

    .my-garden-plant-remove svg {
      width: 12px;
      height: 12px;
    }

    /* ==========================================================================
       Nurseries Section
       ========================================================================== */
    .nurseries-section {
      margin-bottom: var(--space-lg);
      padding: var(--space-md);
      background: var(--color-cream);
      border-radius: var(--radius-lg);
    }

    .nurseries-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: var(--space-sm);
    }

    .nurseries-title {
      font-family: var(--font-heading);
      font-size: 1.125rem;
      font-weight: 600;
      margin: 0;
      color: var(--color-bay-deep);
    }

    .nurseries-subtitle {
      font-size: 0.8125rem;
      color: var(--color-muted);
      margin: 0 0 var(--space-md) 0;
      font-style: italic;
    }

    .nurseries-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .nursery-item {
      display: flex;
      gap: var(--space-md);
      padding: var(--space-sm);
      background: white;
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
    }

    .nursery-item:hover {
      box-shadow: var(--shadow-sm);
    }

    .nursery-icon {
      width: 40px;
      height: 40px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-sage);
      border-radius: var(--radius-sm);
      color: white;
    }

    .nursery-icon svg {
      width: 20px;
      height: 20px;
    }

    .nursery-content {
      flex: 1;
      min-width: 0;
    }

    .nursery-name {
      font-weight: 600;
      font-size: 0.9375rem;
      margin-bottom: 0.25rem;
    }

    .nursery-name a {
      color: var(--color-text);
      text-decoration: none;
      transition: color var(--transition-fast);
    }

    .nursery-name a:hover {
      color: var(--color-sage);
    }

    .nursery-address {
      font-size: 0.8125rem;
      color: var(--color-muted);
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .nursery-note {
      font-size: 0.75rem;
      color: var(--color-sage);
      margin-top: 0.25rem;
      font-style: italic;
    }

    /* ==========================================================================
       Export Section
       ========================================================================== */
    .export-section {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-sm);
      padding: var(--space-md);
      background: var(--color-cream);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-lg);
    }

    .export-title {
      width: 100%;
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--color-text);
      margin: 0 0 var(--space-xs) 0;
    }

    .export-btn {
      flex: 1;
      min-width: 140px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-family: var(--font-body);
      font-size: 0.875rem;
      font-weight: 500;
      padding: 0.75rem 1rem;
      border: none;
      background: var(--color-bay-deep);
      color: white;
      cursor: pointer;
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
    }

    .export-btn:hover {
      background: var(--color-sage);
      transform: translateY(-1px);
    }

    .export-btn svg {
      width: 16px;
      height: 16px;
    }

    .export-btn--secondary {
      background: white;
      color: var(--color-text);
      border: 1px solid var(--color-border);
    }

    .export-btn--secondary:hover {
      background: var(--color-bg-alt);
      border-color: var(--color-sage);
    }

    /* ==========================================================================
       Unsupported Region Message
       ========================================================================== */
    .unsupported-message {
      text-align: center;
      padding: var(--space-xl) var(--space-md);
      background: var(--color-cream);
      border-radius: var(--radius-lg);
    }

    .unsupported-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto var(--space-md);
      color: var(--color-sage);
    }

    .unsupported-title {
      font-family: var(--font-heading);
      font-size: 1.375rem;
      font-weight: 600;
      margin: 0 0 var(--space-sm) 0;
      color: var(--color-bay-deep);
    }

    .unsupported-text {
      color: var(--color-muted);
      margin: 0 0 var(--space-md) 0;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    .unsupported-link {
      color: var(--color-sage);
      font-weight: 500;
      transition: color var(--transition-fast);
    }

    .unsupported-link:hover {
      color: var(--color-bay-deep);
    }

    /* ==========================================================================
       Footer
       ========================================================================== */
    .site-footer {
      padding: var(--space-md) var(--space-md);
      text-align: center;
      font-size: 0.8125rem;
      color: var(--color-muted);
      border-top: 1px solid var(--color-border);
      background: rgba(245, 242, 235, 0.5);
    }

    .footer-content {
      max-width: 480px;
      margin: 0 auto;
    }

    .privacy-note {
      margin: 0 0 0.5rem 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .privacy-note svg {
      width: 14px;
      height: 14px;
      color: var(--color-sage);
    }

    .data-source {
      margin: 0;
    }

    .data-source a {
      color: var(--color-sage);
      text-decoration: none;
      font-weight: 500;
      transition: color var(--transition-fast);
    }

    .data-source a:hover {
      color: var(--color-bay-deep);
    }

    /* ==========================================================================
       Animations
       ========================================================================== */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }

    .animate-fade-in {
      animation: fadeInUp 0.4s ease forwards;
    }

    .animate-stagger-1 { animation-delay: 0.05s; }
    .animate-stagger-2 { animation-delay: 0.1s; }
    .animate-stagger-3 { animation-delay: 0.15s; }
    .animate-stagger-4 { animation-delay: 0.2s; }
    .animate-stagger-5 { animation-delay: 0.25s; }

    /* ==========================================================================
       Responsive Adjustments
       ========================================================================== */
    @media (max-width: 640px) {
      .input-title {
        font-size: 1.75rem;
      }

      .input-tagline {
        font-size: 1rem;
      }

      .filter-groups {
        flex-direction: column;
      }

      .category-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
    }

    @media (max-width: 480px) {
      .site-header {
        padding: var(--space-xs) var(--space-sm);
      }

      main {
        padding: var(--space-md) var(--space-sm);
      }

      .input-title {
        font-size: 1.5rem;
      }

      .input-grid {
        gap: var(--space-md);
      }

      .results-title {
        font-size: 1.375rem;
      }

      .export-section {
        flex-direction: column;
      }

      .export-btn {
        width: 100%;
      }
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */
    @media (prefers-reduced-motion: reduce) {
      .plant-card,
      .results-section,
      .filter-pill,
      .layer-row,
      .export-btn,
      .find-btn {
        transition: none;
      }

      .animate-fade-in {
        animation: none;
        opacity: 1;
      }

      .plant-card:hover,
      .find-btn:hover,
      .export-btn:hover {
        transform: none;
      }
    }

    /* ==========================================================================
       Print Styles
       ========================================================================== */
    @media print {
      body {
        background: white;
        background-image: none;
      }

      body::before {
        display: none;
      }

      .site-header,
      .site-footer,
      .export-section,
      .reset-link,
      .find-btn,
      .input-section,
      .filter-section,
      .my-garden-section,
      .plant-favorite,
      .layers-overview {
        display: none !important;
      }

      main {
        max-width: 100%;
        padding: 0;
      }

      .plant-card {
        break-inside: avoid;
        page-break-inside: avoid;
        box-shadow: none;
        border: 1px solid #ddd;
      }

      .plant-card:hover {
        transform: none;
        box-shadow: none;
      }

      .category-header {
        position: static;
        background: #f5f5f5;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <a href="index.html" class="site-brand" aria-label="Return to home">BS.</a>
    <div class="header-meta">
      <span class="tool-label">Native Plant Finder</span>
      <button class="reset-link" id="header-reset" type="button">Start over</button>
    </div>
  </header>

  <main>
    <div class="tool" id="tool" role="application" aria-label="Native Plant Finder tool">
      <!-- Input Section -->
      <section class="input-section" id="input-section">
        <div class="input-header">
          <h1 class="input-title">Native Plant Finder</h1>
          <p class="input-tagline">Discover what grows here</p>
          <p class="input-subtitle">Find California native plants that thrive in your specific conditions. Support local pollinators, birds, and beneficial insects while reducing water and maintenance.</p>
        </div>

        <div class="input-grid">
          <div class="input-group">
            <label class="input-label" for="zip-input">
              <svg class="input-label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              Your Location
            </label>
            <input
              type="text"
              class="input-text"
              id="zip-input"
              placeholder="Enter zip code"
              maxlength="5"
              inputmode="numeric"
              pattern="[0-9]*"
              aria-describedby="zip-help zip-error"
            >
            <span class="input-help" id="zip-help">Currently supporting San Mateo area (94402)</span>
            <span class="input-error" id="zip-error" role="alert">Please enter a valid 5-digit zip code</span>
          </div>

          <div class="input-group">
            <label class="input-label" for="sun-input">
              <svg class="input-label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
              </svg>
              Sun Exposure
            </label>
            <div class="sun-slider-container">
              <div class="sun-slider-value" id="sun-value">Part Sun (4-6 hrs)</div>
              <div class="sun-slider-track">
                <input
                  type="range"
                  class="sun-slider-input"
                  id="sun-input"
                  min="1"
                  max="4"
                  value="3"
                  aria-label="Sun exposure level"
                  aria-valuemin="1"
                  aria-valuemax="4"
                  aria-valuenow="3"
                  aria-valuetext="Part Sun, 4 to 6 hours"
                >
              </div>
              <div class="sun-slider-labels">
                <span class="sun-slider-label">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 18a5 5 0 0 0-10 0"></path>
                    <line x1="12" y1="9" x2="12" y2="2"></line>
                    <line x1="4.22" y1="10.22" x2="5.64" y2="11.64"></line>
                    <line x1="1" y1="18" x2="3" y2="18"></line>
                    <line x1="21" y1="18" x2="23" y2="18"></line>
                    <line x1="18.36" y1="11.64" x2="19.78" y2="10.22"></line>
                  </svg>
                  Shade
                </span>
                <span class="sun-slider-label">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                  </svg>
                  Full Sun
                </span>
              </div>
            </div>
          </div>
        </div>

        <button type="button" class="find-btn" id="find-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          Find Plants
        </button>
      </section>

      <!-- Results Section (hidden initially) -->
      <section class="results-section is-hidden" id="results-section">
        <!-- Populated by JavaScript -->
      </section>
    </div>
  </main>

  <footer class="site-footer">
    <div class="footer-content">
      <p class="privacy-note">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
        </svg>
        Nothing is saved. All data stays in your browser.
      </p>
      <p class="data-source">Plant data sourced from <a href="https://calscape.org" target="_blank" rel="noopener">Calscape.org</a> / California Native Plant Society</p>
    </div>
  </footer>

  <script>
    (function() {
      // ==========================================================================
      // Plant Database
      // ==========================================================================
      var PLANT_DATA = {
        meta: {
          version: "1.0.0",
          lastUpdated: "2025-01-16",
          source: "Calscape.org / California Native Plant Society"
        },
        regions: {
          "94402": {
            name: "San Mateo, CA",
            ecoregion: "Central Coast - California Floristic Province",
            usdaZone: "10a",
            rainfallInches: 20,
            notes: "Mediterranean climate with dry summers, mild wet winters. Coastal influence moderates temperatures."
          }
        },
        heightCategories: {
          ground_cover: { label: "Ground Cover", range: "Under 3 ft", order: 0 },
          low_shrub: { label: "Low Shrubs", range: "2-6 ft", order: 1 },
          tall_shrub: { label: "Tall Shrubs", range: "5-12 ft", order: 2 },
          small_tree: { label: "Small Trees", range: "10-25 ft", order: 3 },
          canopy_tree: { label: "Canopy Trees", range: "25+ ft", order: 4 }
        },
        sunLevels: {
          1: { label: "Full Shade", description: "Less than 2 hours direct sun" },
          2: { label: "Part Shade", description: "2-4 hours direct sun" },
          3: { label: "Part Sun", description: "4-6 hours direct sun" },
          4: { label: "Full Sun", description: "6+ hours direct sun" }
        },
        waterNeeds: {
          very_low: "Very Low",
          low: "Low",
          moderate: "Moderate"
        },
        bloomColors: {
          white: "#FAFAFA",
          yellow: "#FCD34D",
          orange: "#FB923C",
          "orange-red": "#F97316",
          magenta: "#DB2777",
          purple: "#A855F7",
          "blue-purple": "#8B5CF6",
          pink: "#F472B6",
          "pink-red": "#F43F5E",
          "pink-white": "#FDF2F8",
          "white-pink": "#FCE7F3",
          "white-lavender": "#EDE9FE",
          "yellow-green": "#BEF264",
          green: "#86EFAC"
        },
        plants: [
          {
            id: "yarrow",
            commonName: "Common Yarrow",
            scientificName: "Achillea millefolium",
            heightCategory: "ground_cover",
            heightInches: { min: 12, max: 36 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["pollinators", "butterflies", "beneficial_insects"],
            bloomSeason: ["spring", "summer"],
            bloomColor: "white",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 36,
            regions: ["94402"],
            description: "Feathery, aromatic foliage with flat-topped flower clusters. Extremely drought tolerant once established. Spreads to form dense mats."
          },
          {
            id: "california_fuchsia",
            commonName: "California Fuchsia",
            scientificName: "Epilobium canum",
            heightCategory: "ground_cover",
            heightInches: { min: 12, max: 24 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["hummingbirds", "pollinators"],
            bloomSeason: ["summer", "fall"],
            bloomColor: "orange-red",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 36,
            regions: ["94402"],
            description: "Brilliant tubular flowers attract hummingbirds late in the season when little else blooms. Gray-green foliage."
          },
          {
            id: "beach_strawberry",
            commonName: "Beach Strawberry",
            scientificName: "Fragaria chiloensis",
            heightCategory: "ground_cover",
            heightInches: { min: 4, max: 8 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["birds", "pollinators", "erosion_control"],
            bloomSeason: ["spring"],
            bloomColor: "white",
            difficulty: "easy",
            deerResistant: false,
            spreadInches: 24,
            regions: ["94402"],
            description: "Excellent evergreen groundcover with glossy leaves, white flowers, and small edible fruit. Parent species of commercial strawberries."
          },
          {
            id: "douglas_iris",
            commonName: "Douglas Iris",
            scientificName: "Iris douglasiana",
            heightCategory: "ground_cover",
            heightInches: { min: 12, max: 24 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["pollinators"],
            bloomSeason: ["spring"],
            bloomColor: "purple",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 24,
            regions: ["94402"],
            description: "Elegant sword-like foliage with purple to blue flowers in spring. Tolerates a wide range of conditions including clay soil."
          },
          {
            id: "coast_buckwheat",
            commonName: "Coast Buckwheat",
            scientificName: "Eriogonum latifolium",
            heightCategory: "ground_cover",
            heightInches: { min: 12, max: 24 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["pollinators", "butterflies", "beneficial_insects", "birds"],
            bloomSeason: ["summer", "fall"],
            bloomColor: "pink-white",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 36,
            regions: ["94402"],
            description: "Powerhouse pollinator plant. Long-lasting flower heads age from white to rose to rust. Host plant for several butterfly species."
          },
          {
            id: "hummingbird_sage",
            commonName: "Hummingbird Sage",
            scientificName: "Salvia spathacea",
            heightCategory: "ground_cover",
            heightInches: { min: 12, max: 36 },
            sunMin: 1,
            sunMax: 3,
            waterNeeds: "low",
            ecologicalValue: ["hummingbirds", "pollinators"],
            bloomSeason: ["spring"],
            bloomColor: "magenta",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 36,
            regions: ["94402"],
            description: "One of the best shade-tolerant natives. Large aromatic leaves and magenta flower spikes. Spreads by rhizomes to form colonies."
          },
          {
            id: "california_sagebrush",
            commonName: "California Sagebrush",
            scientificName: "Artemisia californica",
            heightCategory: "low_shrub",
            heightInches: { min: 24, max: 60 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["birds", "beneficial_insects"],
            bloomSeason: ["fall"],
            bloomColor: "yellow",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 72,
            regions: ["94402"],
            description: "Aromatic silvery-green foliage with that classic California coastal sage scent. Virtually indestructible once established."
          },
          {
            id: "coyote_brush",
            commonName: "Coyote Brush",
            scientificName: "Baccharis pilularis",
            heightCategory: "low_shrub",
            heightInches: { min: 12, max: 96 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["pollinators", "birds", "butterflies", "erosion_control"],
            bloomSeason: ["fall", "winter"],
            bloomColor: "white",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 72,
            regions: ["94402"],
            description: "Workhorse native shrub. Dwarf forms available for groundcover. Pioneer species that establishes easily and supports dozens of insect species."
          },
          {
            id: "sticky_monkey",
            commonName: "Sticky Monkeyflower",
            scientificName: "Diplacus aurantiacus",
            heightCategory: "low_shrub",
            heightInches: { min: 24, max: 48 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["hummingbirds", "pollinators"],
            bloomSeason: ["spring", "summer"],
            bloomColor: "orange",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 48,
            regions: ["94402"],
            description: "Cheerful orange tubular flowers bloom for months. Tolerates poor soil and drought. Hummingbird magnet."
          },
          {
            id: "salvia_clevelandii",
            commonName: "Cleveland Sage",
            scientificName: "Salvia clevelandii",
            heightCategory: "low_shrub",
            heightInches: { min: 36, max: 60 },
            sunMin: 4,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["hummingbirds", "pollinators", "butterflies"],
            bloomSeason: ["spring", "summer"],
            bloomColor: "blue-purple",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 60,
            regions: ["94402"],
            description: "Intensely fragrant gray-green foliage. Whorls of blue-violet flowers loved by hummingbirds. Requires excellent drainage."
          },
          {
            id: "black_sage",
            commonName: "Black Sage",
            scientificName: "Salvia mellifera",
            heightCategory: "low_shrub",
            heightInches: { min: 36, max: 72 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["pollinators", "birds", "beneficial_insects"],
            bloomSeason: ["spring", "summer"],
            bloomColor: "white-lavender",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 72,
            regions: ["94402"],
            description: "Major honey-producing plant. Aromatic foliage goes dormant in summer drought. Essential coastal sage scrub species."
          },
          {
            id: "coffeeberry",
            commonName: "California Coffeeberry",
            scientificName: "Frangula californica",
            heightCategory: "tall_shrub",
            heightInches: { min: 72, max: 144 },
            sunMin: 1,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["birds", "pollinators"],
            bloomSeason: ["spring"],
            bloomColor: "green",
            difficulty: "easy",
            deerResistant: false,
            spreadInches: 96,
            regions: ["94402"],
            description: "Versatile evergreen shrub tolerating sun to full shade. Berries ripen from green to red to black, attracting birds. Dwarf cultivars available."
          },
          {
            id: "toyon",
            commonName: "Toyon",
            scientificName: "Heteromeles arbutifolia",
            heightCategory: "tall_shrub",
            heightInches: { min: 72, max: 180 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["birds", "pollinators"],
            bloomSeason: ["summer"],
            bloomColor: "white",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 120,
            regions: ["94402"],
            description: "The plant that gave Hollywood its name. Bright red winter berries attract birds. Can be trained as small tree or kept as shrub."
          },
          {
            id: "red_flowering_currant",
            commonName: "Red Flowering Currant",
            scientificName: "Ribes sanguineum",
            heightCategory: "tall_shrub",
            heightInches: { min: 60, max: 120 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["hummingbirds", "pollinators", "birds"],
            bloomSeason: ["winter", "spring"],
            bloomColor: "pink-red",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 72,
            regions: ["94402"],
            description: "One of the first plants to bloom in late winter. Drooping clusters of pink flowers are critical early hummingbird food. Blue berries follow."
          },
          {
            id: "manzanita",
            commonName: "Common Manzanita",
            scientificName: "Arctostaphylos manzanita",
            heightCategory: "tall_shrub",
            heightInches: { min: 72, max: 144 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["pollinators", "birds"],
            bloomSeason: ["winter", "spring"],
            bloomColor: "white-pink",
            difficulty: "moderate",
            deerResistant: true,
            spreadInches: 96,
            regions: ["94402"],
            description: "Beautiful red bark and urn-shaped flowers. Many cultivars available from groundcover to tree-sized. Critical early pollinator food."
          },
          {
            id: "western_redbud",
            commonName: "Western Redbud",
            scientificName: "Cercis occidentalis",
            heightCategory: "small_tree",
            heightInches: { min: 120, max: 240 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["pollinators", "birds"],
            bloomSeason: ["spring"],
            bloomColor: "magenta",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 180,
            regions: ["94402"],
            description: "Stunning spring display of magenta flowers on bare branches. Heart-shaped leaves turn yellow in fall. Multi-trunked form."
          },
          {
            id: "blue_elderberry",
            commonName: "Blue Elderberry",
            scientificName: "Sambucus nigra ssp. caerulea",
            heightCategory: "small_tree",
            heightInches: { min: 120, max: 300 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["birds", "pollinators", "butterflies"],
            bloomSeason: ["spring", "summer"],
            bloomColor: "white",
            difficulty: "easy",
            deerResistant: false,
            spreadInches: 180,
            regions: ["94402"],
            description: "Fast-growing with creamy flower clusters and blue berries beloved by birds. Berries edible when cooked. Important wildlife plant."
          },
          {
            id: "california_buckeye",
            commonName: "California Buckeye",
            scientificName: "Aesculus californica",
            heightCategory: "small_tree",
            heightInches: { min: 120, max: 300 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["pollinators", "butterflies"],
            bloomSeason: ["spring"],
            bloomColor: "white-pink",
            difficulty: "moderate",
            deerResistant: true,
            spreadInches: 240,
            regions: ["94402"],
            description: "Distinctive deciduous tree with fragrant flower spikes. Drops leaves in summer drought, revealing silvery bark. Toxic to honeybees."
          },
          {
            id: "coast_live_oak",
            commonName: "Coast Live Oak",
            scientificName: "Quercus agrifolia",
            heightCategory: "canopy_tree",
            heightInches: { min: 240, max: 600 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["birds", "butterflies", "beneficial_insects"],
            bloomSeason: ["spring"],
            bloomColor: "yellow",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 600,
            regions: ["94402"],
            description: "Iconic California tree supporting 300+ species of insects and wildlife. Long-lived. Do not irrigate established trees in summer."
          },
          {
            id: "california_bay_laurel",
            commonName: "California Bay Laurel",
            scientificName: "Umbellularia californica",
            heightCategory: "canopy_tree",
            heightInches: { min: 240, max: 600 },
            sunMin: 1,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["birds", "pollinators"],
            bloomSeason: ["winter", "spring"],
            bloomColor: "yellow-green",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 480,
            regions: ["94402"],
            description: "Aromatic evergreen leaves used in cooking (stronger than Mediterranean bay). Tolerates heavy shade. Can cause sudden oak death if planted near oaks."
          }
        ],
        nurseries: [
          {
            name: "Yerba Buena Nursery",
            address: "19500 Skyline Blvd, Woodside, CA",
            url: "https://www.yerbabuenanursery.com",
            notes: "Local to Peninsula, specializes in natives"
          },
          {
            name: "Mostly Natives Nursery",
            address: "27235 Highway 1, Tomales, CA",
            url: "https://www.mostlynatives.com",
            notes: "Excellent selection of locally-sourced natives"
          },
          {
            name: "California Flora Nursery",
            address: "2990 Somers St, Fulton, CA",
            url: "https://www.calfloranursery.com",
            notes: "Wide variety of California natives"
          }
        ],
        ecologicalIcons: {
          pollinators: "Pollinators",
          hummingbirds: "Hummingbirds",
          butterflies: "Butterflies",
          birds: "Birds",
          beneficial_insects: "Beneficial Insects",
          erosion_control: "Erosion Control"
        }
      };

      // ==========================================================================
      // DOM Elements
      // ==========================================================================
      var tool = document.getElementById('tool');
      var headerReset = document.getElementById('header-reset');
      var inputSection = document.getElementById('input-section');
      var resultsSection = document.getElementById('results-section');
      var zipInput = document.getElementById('zip-input');
      var zipError = document.getElementById('zip-error');
      var sunInput = document.getElementById('sun-input');
      var sunValue = document.getElementById('sun-value');
      var findBtn = document.getElementById('find-btn');

      // ==========================================================================
      // State
      // ==========================================================================
      var state = {
        zipCode: '',
        sunLevel: 3,
        region: null,
        filteredPlants: [],
        displayedPlants: [],
        expandedPlantId: null,
        filters: {
          water: [],
          wildlife: [],
          care: []
        },
        favorites: loadFavorites()
      };

      // Category descriptions for the new design
      var categoryDescriptions = {
        canopy_tree: "The backbone of your garden",
        small_tree: "Structure and seasonal interest",
        tall_shrub: "Privacy and wildlife habitat",
        low_shrub: "Color and fragrance",
        ground_cover: "Knit it all together"
      };

      // Icons SVG paths
      var ICONS = {
        heart: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>',
        heartFilled: '<svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>',
        droplet: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path></svg>',
        bird: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 7h.01M3.4 18H12a8 8 0 0 0 8-8V7a4 4 0 0 0-7.28-2.28L2 20"></path></svg>',
        check: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>',
        deer: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="3"/><path d="M12 11v4"/><path d="M9 8V5L7 3M15 8V5l2-2"/><path d="M8 19l4-4 4 4"/></svg>',
        plant: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 20h10M10 20c0-3.37 2-6 2-8s-2-4.5-2-6.5c0 2 2 4.5 2 6.5s-2 4.63-2 8zM12 14c1.5 0 4.5-1.5 4.5-5.5 0 4-3 5.5-4.5 5.5zm0 0c-1.5 0-4.5-1.5-4.5-5.5 0 4 3 5.5 4.5 5.5z"></path></svg>',
        layers: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>',
        download: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>',
        printer: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>',
        share: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>',
        store: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>',
        external: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>',
        x: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',
        mapPin: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>'
      };

      // Load favorites from localStorage
      function loadFavorites() {
        try {
          var saved = localStorage.getItem('nativePlantFavorites');
          return saved ? JSON.parse(saved) : [];
        } catch (e) {
          return [];
        }
      }

      // Save favorites to localStorage
      function saveFavorites() {
        try {
          localStorage.setItem('nativePlantFavorites', JSON.stringify(state.favorites));
        } catch (e) {
          // localStorage not available
        }
      }

      // ==========================================================================
      // Helpers
      // ==========================================================================
      function validateZip(zip) {
        return /^\d{5}$/.test(zip);
      }

      function isRegionSupported(zip) {
        return PLANT_DATA.regions.hasOwnProperty(zip);
      }

      function filterPlants(zip, sunLevel) {
        return PLANT_DATA.plants.filter(function(plant) {
          var inRegion = plant.regions.indexOf(zip) !== -1;
          var sunMatch = sunLevel >= plant.sunMin && sunLevel <= plant.sunMax;
          return inRegion && sunMatch;
        });
      }

      function groupByCategory(plants) {
        var groups = {};
        plants.forEach(function(plant) {
          var cat = plant.heightCategory;
          if (!groups[cat]) {
            groups[cat] = [];
          }
          groups[cat].push(plant);
        });
        return groups;
      }

      // Apply additional filters to plants
      function applyFilters(plants) {
        return plants.filter(function(plant) {
          // Water filter
          if (state.filters.water.length > 0) {
            if (state.filters.water.indexOf(plant.waterNeeds) === -1) {
              return false;
            }
          }

          // Wildlife filter
          if (state.filters.wildlife.length > 0) {
            var hasWildlife = state.filters.wildlife.some(function(w) {
              return plant.ecologicalValue.indexOf(w) !== -1;
            });
            if (!hasWildlife) return false;
          }

          // Care filter
          if (state.filters.care.length > 0) {
            var matchesCare = state.filters.care.some(function(c) {
              if (c === 'easy') return plant.difficulty === 'easy';
              if (c === 'deer') return plant.deerResistant;
              return false;
            });
            if (!matchesCare) return false;
          }

          return true;
        });
      }

      // Toggle favorite
      function toggleFavorite(plantId) {
        var idx = state.favorites.indexOf(plantId);
        if (idx === -1) {
          state.favorites.push(plantId);
        } else {
          state.favorites.splice(idx, 1);
        }
        saveFavorites();
        updateFavoriteButtons();
        updateMyGardenSection();
      }

      // Check if plant is favorited
      function isFavorited(plantId) {
        return state.favorites.indexOf(plantId) !== -1;
      }

      function formatHeight(inches) {
        if (inches.max < 12) {
          return inches.min + '-' + inches.max + '"';
        }
        var minFt = Math.floor(inches.min / 12);
        var maxFt = Math.ceil(inches.max / 12);
        if (minFt === maxFt) {
          return minFt + ' ft';
        }
        return minFt + '-' + maxFt + ' ft';
      }

      function formatSeason(seasons) {
        return seasons.map(function(s) {
          return s.charAt(0).toUpperCase() + s.slice(1);
        }).join(', ');
      }

      function getSunLabel(level) {
        var labels = {
          1: "Full Shade (< 2 hrs)",
          2: "Part Shade (2-4 hrs)",
          3: "Part Sun (4-6 hrs)",
          4: "Full Sun (6+ hrs)"
        };
        return labels[level] || '';
      }

      // ==========================================================================
      // Sun Slider
      // ==========================================================================
      sunInput.addEventListener('input', function() {
        state.sunLevel = parseInt(sunInput.value, 10);
        var label = getSunLabel(state.sunLevel);
        sunValue.textContent = label;
        sunInput.setAttribute('aria-valuenow', state.sunLevel);
        sunInput.setAttribute('aria-valuetext', label);
      });

      // ==========================================================================
      // Zip Input
      // ==========================================================================
      zipInput.addEventListener('input', function() {
        var value = zipInput.value.replace(/\D/g, '').slice(0, 5);
        zipInput.value = value;
        state.zipCode = value;

        // Clear error state
        zipInput.classList.remove('is-invalid');
        zipError.classList.remove('is-visible');
      });

      zipInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          findBtn.click();
        }
      });

      // ==========================================================================
      // Find Plants Button
      // ==========================================================================
      findBtn.addEventListener('click', function() {
        var zip = state.zipCode;

        // Validate
        if (!validateZip(zip)) {
          zipInput.classList.add('is-invalid');
          zipError.classList.add('is-visible');
          zipInput.focus();
          return;
        }

        // Find plants and show results
        state.region = PLANT_DATA.regions[zip] || null;
        state.filteredPlants = filterPlants(zip, state.sunLevel);
        showResults();
      });

      // ==========================================================================
      // Header Reset
      // ==========================================================================
      headerReset.addEventListener('click', function() {
        resetTool();
      });

      function resetTool() {
        state.zipCode = '';
        state.sunLevel = 3;
        state.region = null;
        state.filteredPlants = [];
        state.displayedPlants = [];
        state.expandedPlantId = null;
        state.filters = { water: [], wildlife: [], care: [] };

        zipInput.value = '';
        sunInput.value = 3;
        sunValue.textContent = getSunLabel(3);
        sunInput.setAttribute('aria-valuetext', 'Part Sun, 4 to 6 hours');
        zipInput.classList.remove('is-invalid');
        zipError.classList.remove('is-visible');

        resultsSection.classList.add('is-hidden');
        inputSection.style.display = '';
        headerReset.classList.remove('is-visible');
      }

      // ==========================================================================
      // Show Results
      // ==========================================================================
      function showResults() {
        headerReset.classList.add('is-visible');

        if (!isRegionSupported(state.zipCode)) {
          renderUnsupportedRegion();
        } else {
          renderResults();
        }

        resultsSection.classList.remove('is-hidden');
      }

      // ==========================================================================
      // Render Unsupported Region
      // ==========================================================================
      function renderUnsupportedRegion() {
        var html = '' +
          '<div class="unsupported-message">' +
            '<div class="unsupported-icon">' + ICONS.mapPin + '</div>' +
            '<h2 class="unsupported-title">Region Not Yet Supported</h2>' +
            '<p class="unsupported-text">' +
              'We currently have plant data for the San Mateo, CA area (94402). ' +
              'More regions coming soon!' +
            '</p>' +
            '<p class="unsupported-text">' +
              'In the meantime, try <a href="https://calscape.org" target="_blank" rel="noopener" class="unsupported-link">Calscape.org</a> ' +
              'to find native plants for your California location.' +
            '</p>' +
            '<button type="button" class="find-btn" id="try-again-btn">' +
              '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>' +
              'Try Another Zip' +
            '</button>' +
          '</div>';

        resultsSection.innerHTML = html;

        document.getElementById('try-again-btn').addEventListener('click', function() {
          resetTool();
          zipInput.focus();
        });
      }

      // ==========================================================================
      // Render Results
      // ==========================================================================
      function renderResults() {
        var region = state.region;
        state.displayedPlants = applyFilters(state.filteredPlants);
        var plants = state.displayedPlants;
        var grouped = groupByCategory(plants);

        var html = '' +
          '<div class="results-header">' +
            '<h2 class="results-title">' + state.filteredPlants.length + ' Native Plants for Your Garden</h2>' +
            '<p class="results-meta">Filtered for ' + getSunLabel(state.sunLevel).toLowerCase() + ' conditions</p>' +
            '<div class="region-badge">' +
              ICONS.mapPin +
              '<span>' + region.name + ' · USDA Zone ' + region.usdaZone + '</span>' +
            '</div>' +
          '</div>';

        // My Garden Section (favorites)
        html += renderMyGarden();

        // Filter Section
        html += renderFilters();

        // Layers Overview (simplified landscape)
        html += renderLayersOverview(grouped);

        // Plant Cards by Category
        html += '<div class="plants-section" id="plants-section">';

        var categoryOrder = ['canopy_tree', 'small_tree', 'tall_shrub', 'low_shrub', 'ground_cover'];
        categoryOrder.forEach(function(catKey) {
          if (grouped[catKey] && grouped[catKey].length > 0) {
            html += renderCategory(catKey, grouped[catKey]);
          }
        });

        html += '</div>';

        // Nurseries
        html += renderNurseries();

        // Export Section
        html += renderExportSection();

        resultsSection.innerHTML = html;

        // Attach event listeners
        attachPlantCardListeners();
        attachExportListeners();
        attachFilterListeners();
        attachLayerListeners();
        attachFavoriteListeners();
      }

      // Re-render just the plants section when filters change
      function updatePlantsDisplay() {
        state.displayedPlants = applyFilters(state.filteredPlants);
        var grouped = groupByCategory(state.displayedPlants);

        var plantsSection = document.getElementById('plants-section');
        if (!plantsSection) return;

        var html = '';
        var categoryOrder = ['canopy_tree', 'small_tree', 'tall_shrub', 'low_shrub', 'ground_cover'];
        categoryOrder.forEach(function(catKey) {
          if (grouped[catKey] && grouped[catKey].length > 0) {
            html += renderCategory(catKey, grouped[catKey]);
          }
        });

        plantsSection.innerHTML = html;

        // Update filter count
        var filterCount = document.querySelector('.filter-count');
        if (filterCount) {
          filterCount.innerHTML = 'Showing <strong>' + state.displayedPlants.length + '</strong> of ' + state.filteredPlants.length + ' plants';
        }

        // Update layers overview
        var layersSection = document.querySelector('.layers-overview');
        if (layersSection) {
          layersSection.outerHTML = renderLayersOverview(grouped);
          attachLayerListeners();
        }

        // Re-attach listeners
        attachPlantCardListeners();
        attachFavoriteListeners();
      }

      // ==========================================================================
      // My Garden (Favorites) Section
      // ==========================================================================
      function renderMyGarden() {
        var favoritedPlants = state.favorites.map(function(id) {
          return PLANT_DATA.plants.find(function(p) { return p.id === id; });
        }).filter(Boolean);

        if (favoritedPlants.length === 0) {
          return '<div class="my-garden-section is-hidden" id="my-garden-section"></div>';
        }

        var html = '' +
          '<div class="my-garden-section" id="my-garden-section">' +
            '<div class="my-garden-header">' +
              '<h3 class="my-garden-title">' + ICONS.heartFilled + ' My Garden</h3>' +
              '<span class="my-garden-count">' + favoritedPlants.length + ' plant' + (favoritedPlants.length !== 1 ? 's' : '') + ' selected</span>' +
            '</div>' +
            '<div class="my-garden-plants">';

        favoritedPlants.forEach(function(plant) {
          html += '' +
            '<div class="my-garden-plant" data-plant-id="' + plant.id + '">' +
              '<span>' + plant.commonName + '</span>' +
              '<button class="my-garden-plant-remove" data-plant-id="' + plant.id + '" aria-label="Remove ' + plant.commonName + ' from My Garden">' +
                ICONS.x +
              '</button>' +
            '</div>';
        });

        html += '</div></div>';
        return html;
      }

      function updateMyGardenSection() {
        var section = document.getElementById('my-garden-section');
        if (section) {
          section.outerHTML = renderMyGarden();
          // Re-attach remove listeners
          document.querySelectorAll('.my-garden-plant-remove').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
              e.stopPropagation();
              var plantId = btn.getAttribute('data-plant-id');
              toggleFavorite(plantId);
            });
          });
        }
      }

      // ==========================================================================
      // Filters Section
      // ==========================================================================
      function renderFilters() {
        var hasActiveFilters = state.filters.water.length > 0 ||
                               state.filters.wildlife.length > 0 ||
                               state.filters.care.length > 0;

        var html = '' +
          '<div class="filter-section">' +
            '<div class="filter-groups">' +
              // Water filters
              '<div class="filter-group">' +
                '<span class="filter-group-label">Water Needs</span>' +
                '<div class="filter-pills">' +
                  '<button class="filter-pill' + (state.filters.water.indexOf('very_low') !== -1 ? ' is-active' : '') + '" data-filter="water" data-value="very_low">' +
                    ICONS.droplet + ' Very Low' +
                  '</button>' +
                  '<button class="filter-pill' + (state.filters.water.indexOf('low') !== -1 ? ' is-active' : '') + '" data-filter="water" data-value="low">' +
                    ICONS.droplet + ' Low' +
                  '</button>' +
                  '<button class="filter-pill' + (state.filters.water.indexOf('moderate') !== -1 ? ' is-active' : '') + '" data-filter="water" data-value="moderate">' +
                    ICONS.droplet + ' Moderate' +
                  '</button>' +
                '</div>' +
              '</div>' +
              // Wildlife filters
              '<div class="filter-group">' +
                '<span class="filter-group-label">Wildlife</span>' +
                '<div class="filter-pills">' +
                  '<button class="filter-pill' + (state.filters.wildlife.indexOf('hummingbirds') !== -1 ? ' is-active' : '') + '" data-filter="wildlife" data-value="hummingbirds">' +
                    ICONS.bird + ' Hummingbirds' +
                  '</button>' +
                  '<button class="filter-pill' + (state.filters.wildlife.indexOf('butterflies') !== -1 ? ' is-active' : '') + '" data-filter="wildlife" data-value="butterflies">' +
                    'Butterflies' +
                  '</button>' +
                  '<button class="filter-pill' + (state.filters.wildlife.indexOf('birds') !== -1 ? ' is-active' : '') + '" data-filter="wildlife" data-value="birds">' +
                    'Birds' +
                  '</button>' +
                '</div>' +
              '</div>' +
              // Care filters
              '<div class="filter-group">' +
                '<span class="filter-group-label">Care</span>' +
                '<div class="filter-pills">' +
                  '<button class="filter-pill' + (state.filters.care.indexOf('easy') !== -1 ? ' is-active' : '') + '" data-filter="care" data-value="easy">' +
                    ICONS.check + ' Easy' +
                  '</button>' +
                  '<button class="filter-pill' + (state.filters.care.indexOf('deer') !== -1 ? ' is-active' : '') + '" data-filter="care" data-value="deer">' +
                    'Deer Resistant' +
                  '</button>' +
                '</div>' +
              '</div>' +
            '</div>' +
            '<div class="filter-summary">' +
              '<span class="filter-count">Showing <strong>' + state.displayedPlants.length + '</strong> of ' + state.filteredPlants.length + ' plants</span>' +
              (hasActiveFilters ? '<button class="filter-clear" id="filter-clear">Clear filters</button>' : '') +
            '</div>' +
          '</div>';

        return html;
      }

      function attachFilterListeners() {
        document.querySelectorAll('.filter-pill').forEach(function(pill) {
          pill.addEventListener('click', function() {
            var filterType = pill.getAttribute('data-filter');
            var value = pill.getAttribute('data-value');

            var idx = state.filters[filterType].indexOf(value);
            if (idx === -1) {
              state.filters[filterType].push(value);
              pill.classList.add('is-active');
            } else {
              state.filters[filterType].splice(idx, 1);
              pill.classList.remove('is-active');
            }

            updatePlantsDisplay();
          });
        });

        var clearBtn = document.getElementById('filter-clear');
        if (clearBtn) {
          clearBtn.addEventListener('click', function() {
            state.filters = { water: [], wildlife: [], care: [] };
            document.querySelectorAll('.filter-pill.is-active').forEach(function(p) {
              p.classList.remove('is-active');
            });
            updatePlantsDisplay();
          });
        }
      }

      // ==========================================================================
      // Layers Overview (Simplified Landscape)
      // ==========================================================================
      function renderLayersOverview(grouped) {
        var categoryOrder = ['canopy_tree', 'small_tree', 'tall_shrub', 'low_shrub', 'ground_cover'];
        var hasPlants = categoryOrder.some(function(cat) { return grouped[cat] && grouped[cat].length > 0; });

        if (!hasPlants) {
          return '<div class="layers-overview"><p style="text-align:center;color:var(--color-muted);">No plants match your current filters</p></div>';
        }

        var html = '' +
          '<div class="layers-overview">' +
            '<h3 class="layers-overview-title">' + ICONS.layers + ' Garden Layers</h3>' +
            '<div class="layers-stack">';

        categoryOrder.forEach(function(catKey) {
          var category = PLANT_DATA.heightCategories[catKey];
          var plants = grouped[catKey] || [];
          var indicatorClass = catKey.replace('_', '-');

          html += '' +
            '<div class="layer-row" data-category="' + catKey + '" role="button" tabindex="0" aria-label="Jump to ' + category.label + '">' +
              '<div class="layer-indicator layer-indicator--' + indicatorClass + '"></div>' +
              '<div class="layer-info">' +
                '<div class="layer-name">' + category.label + '</div>' +
                '<div class="layer-meta">' + category.range + ' — ' + categoryDescriptions[catKey] + '</div>' +
              '</div>' +
              '<div class="layer-count">' + plants.length + ' plant' + (plants.length !== 1 ? 's' : '') + '</div>' +
            '</div>';
        });

        html += '</div></div>';
        return html;
      }

      function attachLayerListeners() {
        document.querySelectorAll('.layer-row').forEach(function(row) {
          row.addEventListener('click', function() {
            var category = row.getAttribute('data-category');
            scrollToCategory(category);
          });
          row.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              var category = row.getAttribute('data-category');
              scrollToCategory(category);
            }
          });
        });
      }

      function scrollToCategory(categoryKey) {
        var section = document.querySelector('.plants-category[data-category="' + categoryKey + '"]');
        if (section) {
          section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }

      function scrollToPlantCard(plantId) {
        var card = document.querySelector('.plant-card[data-plant-id="' + plantId + '"]');
        if (card) {
          card.scrollIntoView({ behavior: 'smooth', block: 'center' });
          togglePlantCard(card);
          card.style.boxShadow = '0 0 0 3px var(--color-poppy)';
          setTimeout(function() {
            card.style.boxShadow = '';
          }, 1500);
        }
      }

      // ==========================================================================
      // Render Category
      // ==========================================================================
      function renderCategory(categoryKey, plants) {
        var category = PLANT_DATA.heightCategories[categoryKey];

        var html = '' +
          '<div class="plants-category" data-category="' + categoryKey + '">' +
            '<div class="category-header">' +
              '<div class="category-header-content">' +
                '<h3 class="category-title">' + category.label + '</h3>' +
                '<span class="category-subtitle">' + categoryDescriptions[categoryKey] + '</span>' +
              '</div>' +
              '<span class="category-meta">' + plants.length + ' plant' + (plants.length !== 1 ? 's' : '') + ' · ' + category.range + '</span>' +
            '</div>' +
            '<div class="plants-grid">';

        plants.forEach(function(plant, index) {
          html += renderPlantCard(plant, index);
        });

        html += '</div></div>';
        return html;
      }

      // ==========================================================================
      // Render Plant Card
      // ==========================================================================
      function renderPlantCard(plant, index) {
        var bloomColor = PLANT_DATA.bloomColors[plant.bloomColor] || '#ccc';
        var isFav = isFavorited(plant.id);
        var staggerClass = index < 5 ? ' animate-fade-in animate-stagger-' + (index + 1) : ' animate-fade-in';

        // Water tag class
        var waterTagClass = 'plant-tag--water-' + plant.waterNeeds.replace('_', '-');

        var html = '' +
          '<div class="plant-card' + staggerClass + '" data-plant-id="' + plant.id + '" tabindex="0" role="button" aria-expanded="false">' +
            // Plant image placeholder
            '<div class="plant-image-container">' +
              '<div class="plant-placeholder plant-placeholder--' + plant.heightCategory + '">' +
                '<div class="plant-placeholder-icon">' + ICONS.plant + '</div>' +
                '<div class="plant-bloom-badge">' +
                  '<span class="plant-bloom-dot" style="background: ' + bloomColor + ';"></span>' +
                  formatSeason(plant.bloomSeason) +
                '</div>' +
              '</div>' +
            '</div>' +
            // Plant content
            '<div class="plant-content">' +
              '<div class="plant-card-header">' +
                '<div class="plant-name-group">' +
                  '<h4 class="plant-name">' + plant.commonName + '</h4>' +
                  '<p class="plant-scientific">' + plant.scientificName + '</p>' +
                '</div>' +
                '<button class="plant-favorite' + (isFav ? ' is-favorited' : '') + '" data-plant-id="' + plant.id + '" aria-label="' + (isFav ? 'Remove from' : 'Add to') + ' My Garden">' +
                  (isFav ? ICONS.heartFilled : ICONS.heart) +
                '</button>' +
              '</div>' +
              // Tags grouped by type
              '<div class="plant-tags-grouped">' +
                // Water tag
                '<span class="plant-tag ' + waterTagClass + '">' +
                  ICONS.droplet +
                  PLANT_DATA.waterNeeds[plant.waterNeeds] +
                '</span>';

        // Wildlife tags (show up to 2)
        var wildlifeTags = plant.ecologicalValue.slice(0, 2);
        wildlifeTags.forEach(function(val) {
          var label = PLANT_DATA.ecologicalIcons[val] || val;
          html += '<span class="plant-tag plant-tag--wildlife">' + label + '</span>';
        });

        // Care tags
        if (plant.difficulty === 'easy') {
          html += '<span class="plant-tag plant-tag--easy">' + ICONS.check + ' Easy</span>';
        }
        if (plant.deerResistant) {
          html += '<span class="plant-tag plant-tag--deer">Deer Resistant</span>';
        }

        html += '</div>' +
              // Details (expanded)
              '<div class="plant-details">' +
                '<p class="plant-description">' + plant.description + '</p>' +
                '<div class="plant-stats">' +
                  '<div class="plant-stat">' +
                    '<span class="stat-label">Height</span>' +
                    '<span class="stat-value">' + formatHeight(plant.heightInches) + '</span>' +
                  '</div>' +
                  '<div class="plant-stat">' +
                    '<span class="stat-label">Spread</span>' +
                    '<span class="stat-value">' + Math.round(plant.spreadInches / 12) + ' ft</span>' +
                  '</div>' +
                  '<div class="plant-stat">' +
                    '<span class="stat-label">Sun</span>' +
                    '<span class="stat-value">' + formatSunRange(plant.sunMin, plant.sunMax) + '</span>' +
                  '</div>' +
                  '<div class="plant-stat">' +
                    '<span class="stat-label">Water</span>' +
                    '<span class="stat-value">' + PLANT_DATA.waterNeeds[plant.waterNeeds] + '</span>' +
                  '</div>' +
                '</div>' +
                '<a href="https://calscape.org/loc-California/cat-All/ord-popular/vw-list/np-1?srch=' + encodeURIComponent(plant.scientificName) + '" target="_blank" rel="noopener" class="plant-link">' +
                  'View on Calscape ' + ICONS.external +
                '</a>' +
              '</div>' +
            '</div>' +
          '</div>';

        return html;
      }

      // Attach favorite button listeners
      function attachFavoriteListeners() {
        document.querySelectorAll('.plant-favorite').forEach(function(btn) {
          btn.addEventListener('click', function(e) {
            e.stopPropagation();
            var plantId = btn.getAttribute('data-plant-id');
            toggleFavorite(plantId);
          });
        });

        // My garden remove buttons
        document.querySelectorAll('.my-garden-plant-remove').forEach(function(btn) {
          btn.addEventListener('click', function(e) {
            e.stopPropagation();
            var plantId = btn.getAttribute('data-plant-id');
            toggleFavorite(plantId);
          });
        });
      }

      // Update favorite button states
      function updateFavoriteButtons() {
        document.querySelectorAll('.plant-favorite').forEach(function(btn) {
          var plantId = btn.getAttribute('data-plant-id');
          var isFav = isFavorited(plantId);
          btn.classList.toggle('is-favorited', isFav);
          btn.innerHTML = isFav ? ICONS.heartFilled : ICONS.heart;
          btn.setAttribute('aria-label', (isFav ? 'Remove from' : 'Add to') + ' My Garden');
        });
      }

      function formatSunRange(min, max) {
        if (min === max) {
          return PLANT_DATA.sunLevels[min].label;
        }
        return PLANT_DATA.sunLevels[min].label.split(' ')[0] + ' to ' + PLANT_DATA.sunLevels[max].label.split(' ')[0];
      }

      function getContrastColor(hex) {
        // Simple contrast calculation
        var r = parseInt(hex.slice(1, 3), 16);
        var g = parseInt(hex.slice(3, 5), 16);
        var b = parseInt(hex.slice(5, 7), 16);
        var brightness = (r * 299 + g * 587 + b * 114) / 1000;
        return brightness > 128 ? '#1A1A1A' : '#FFFFFF';
      }

      // ==========================================================================
      // Plant Card Interactions
      // ==========================================================================
      function attachPlantCardListeners() {
        var cards = document.querySelectorAll('.plant-card');
        cards.forEach(function(card) {
          card.addEventListener('click', function() {
            togglePlantCard(card);
          });
          card.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              togglePlantCard(card);
            }
          });
        });
      }

      function togglePlantCard(card) {
        var wasExpanded = card.classList.contains('is-expanded');

        // Collapse all other cards
        document.querySelectorAll('.plant-card.is-expanded').forEach(function(c) {
          c.classList.remove('is-expanded');
          c.setAttribute('aria-expanded', 'false');
        });

        // Toggle this card
        if (!wasExpanded) {
          card.classList.add('is-expanded');
          card.setAttribute('aria-expanded', 'true');
          state.expandedPlantId = card.getAttribute('data-plant-id');
        } else {
          state.expandedPlantId = null;
        }
      }

      // ==========================================================================
      // Render Nurseries
      // ==========================================================================
      function renderNurseries() {
        var html = '' +
          '<div class="nurseries-section">' +
            '<div class="nurseries-header">' +
              '<h3 class="nurseries-title">Where to Buy Native Plants</h3>' +
            '</div>' +
            '<p class="nurseries-subtitle">Call ahead to check availability for your plant list</p>' +
            '<ul class="nurseries-list">';

        PLANT_DATA.nurseries.forEach(function(nursery) {
          html += '' +
            '<li class="nursery-item">' +
              '<div class="nursery-icon">' + ICONS.store + '</div>' +
              '<div class="nursery-content">' +
                '<div class="nursery-name"><a href="' + nursery.url + '" target="_blank" rel="noopener">' + nursery.name + ' ' + ICONS.external + '</a></div>' +
                '<div class="nursery-address">' + nursery.address + '</div>' +
                (nursery.notes ? '<div class="nursery-note">' + nursery.notes + '</div>' : '') +
              '</div>' +
            '</li>';
        });

        html += '</ul></div>';
        return html;
      }

      // ==========================================================================
      // Export Section
      // ==========================================================================
      function renderExportSection() {
        var html = '' +
          '<div class="export-section">' +
            '<h4 class="export-title">Save Your Plant List</h4>' +
            '<button type="button" class="export-btn" id="export-pdf-btn">' +
              ICONS.download + ' Download PDF' +
            '</button>' +
            '<button type="button" class="export-btn export-btn--secondary" id="print-btn">' +
              ICONS.printer + ' Print' +
            '</button>' +
            '<button type="button" class="export-btn export-btn--secondary" id="share-btn">' +
              ICONS.share + ' Share' +
            '</button>' +
          '</div>';

        return html;
      }

      // ==========================================================================
      // Export Functionality
      // ==========================================================================
      function attachExportListeners() {
        var pdfBtn = document.getElementById('export-pdf-btn');
        var printBtn = document.getElementById('print-btn');
        var shareBtn = document.getElementById('share-btn');

        if (pdfBtn) {
          pdfBtn.addEventListener('click', generatePDF);
        }
        if (printBtn) {
          printBtn.addEventListener('click', function() {
            window.print();
          });
        }
        if (shareBtn) {
          shareBtn.addEventListener('click', shareResults);
        }
      }

      function shareResults() {
        var shareData = {
          title: 'Native Plants for ' + state.region.name,
          text: 'Check out these ' + state.displayedPlants.length + ' California native plants perfect for ' + getSunLabel(state.sunLevel).toLowerCase() + ' conditions!',
          url: window.location.href
        };

        if (navigator.share) {
          navigator.share(shareData).catch(function(err) {
            // User cancelled or error
            console.log('Share cancelled or failed:', err);
          });
        } else {
          // Fallback: copy URL to clipboard
          navigator.clipboard.writeText(window.location.href).then(function() {
            var btn = document.getElementById('share-btn');
            var originalHTML = btn.innerHTML;
            btn.innerHTML = ICONS.check + ' Link Copied!';
            setTimeout(function() {
              btn.innerHTML = originalHTML;
            }, 2000);
          }).catch(function(err) {
            console.log('Copy failed:', err);
          });
        }
      }

      function generatePDF() {
        var jsPDF = window.jspdf.jsPDF;
        var doc = new jsPDF({
          orientation: 'portrait',
          unit: 'pt',
          format: 'letter'
        });

        var pageWidth = doc.internal.pageSize.getWidth();
        var margin = 40;
        var contentWidth = pageWidth - 2 * margin;
        var y = margin;

        // Title
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(20);
        doc.text('Native Plants for ' + state.zipCode, margin, y);
        y += 30;

        // Subtitle
        doc.setFont('helvetica', 'normal');
        doc.setFontSize(11);
        doc.setTextColor(100);
        doc.text(state.region.name + ' · ' + getSunLabel(state.sunLevel), margin, y);
        y += 25;

        doc.setTextColor(0);

        // Plants by category (use displayedPlants to respect active filters)
        var grouped = groupByCategory(state.displayedPlants);
        var categoryOrder = ['canopy_tree', 'small_tree', 'tall_shrub', 'low_shrub', 'ground_cover'];

        categoryOrder.forEach(function(catKey) {
          if (!grouped[catKey] || grouped[catKey].length === 0) return;

          // Check if we need a new page
          if (y > 700) {
            doc.addPage();
            y = margin;
          }

          var category = PLANT_DATA.heightCategories[catKey];

          // Category header
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(14);
          doc.text(category.label + ' (' + category.range + ')', margin, y);
          y += 20;

          doc.setFont('helvetica', 'normal');
          doc.setFontSize(10);

          grouped[catKey].forEach(function(plant) {
            if (y > 720) {
              doc.addPage();
              y = margin;
            }

            // Plant name
            doc.setFont('helvetica', 'bold');
            doc.text(plant.commonName, margin, y);
            doc.setFont('helvetica', 'italic');
            doc.setTextColor(100);
            var nameWidth = doc.getTextWidth(plant.commonName + '  ');
            doc.text(plant.scientificName, margin + nameWidth, y);
            doc.setTextColor(0);
            y += 14;

            // Plant details
            doc.setFont('helvetica', 'normal');
            var details = formatHeight(plant.heightInches) + ' · ' +
                         PLANT_DATA.waterNeeds[plant.waterNeeds] + ' water · ' +
                         'Blooms ' + formatSeason(plant.bloomSeason);
            doc.text(details, margin, y);
            y += 12;

            // Ecological value
            var ecology = plant.ecologicalValue.map(function(v) {
              return PLANT_DATA.ecologicalIcons[v];
            }).join(', ');
            doc.setTextColor(100);
            doc.text('Supports: ' + ecology, margin, y);
            doc.setTextColor(0);
            y += 18;
          });

          y += 10;
        });

        // Nurseries section
        if (y > 650) {
          doc.addPage();
          y = margin;
        }

        doc.setFont('helvetica', 'bold');
        doc.setFontSize(14);
        doc.text('Where to Buy', margin, y);
        y += 20;

        doc.setFont('helvetica', 'normal');
        doc.setFontSize(10);

        PLANT_DATA.nurseries.forEach(function(nursery) {
          doc.setFont('helvetica', 'bold');
          doc.text(nursery.name, margin, y);
          y += 12;
          doc.setFont('helvetica', 'normal');
          doc.setTextColor(100);
          doc.text(nursery.address, margin, y);
          doc.setTextColor(0);
          y += 16;
        });

        // Footer
        var pageCount = doc.internal.getNumberOfPages();
        for (var i = 1; i <= pageCount; i++) {
          doc.setPage(i);
          doc.setFont('helvetica', 'normal');
          doc.setFontSize(8);
          doc.setTextColor(150);
          doc.text(
            'Generated by Native Plant Finder · bensiverly.com · Data: Calscape.org',
            margin,
            doc.internal.pageSize.getHeight() - 20
          );
        }

        // Save
        doc.save('native-plants-' + state.zipCode + '.pdf');
      }

      // ==========================================================================
      // Initialize
      // ==========================================================================
      sunValue.textContent = getSunLabel(state.sunLevel);

    })();
  </script>
</body>
</html>
