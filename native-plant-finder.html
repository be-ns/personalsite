<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Native Plant Finder — Ben Siverly</title>
  <meta name="description" content="Find native plants that thrive in your area with minimal effort. Support local pollinators, birds, and beneficial insects while reducing water and maintenance.">

  <!-- Open Graph -->
  <meta property="og:title" content="Native Plant Finder — Ben Siverly">
  <meta property="og:description" content="Find native plants that thrive in your area. Support local pollinators and reduce maintenance.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://bensiverly.com/native-plant-finder.html">
  <meta property="og:image" content="https://bensiverly.com/images/og-native-plant-finder.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Native Plant Finder — Ben Siverly">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Native Plant Finder — Ben Siverly">
  <meta name="twitter:description" content="Find native plants that thrive in your area. Support local pollinators and reduce maintenance.">
  <meta name="twitter:image" content="https://bensiverly.com/images/og-native-plant-finder.png">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Zilla+Slab:wght@600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /* ==========================================================================
       CSS Variables
       ========================================================================== */
    :root {
      --color-bg: #FFFFFF;
      --color-bg-alt: #F8F8F6;
      --color-text: #1A1A1A;
      --color-accent: #FFE227;
      --color-accent-hover: #FFD800;
      --color-muted: #666666;
      --color-border: #E5E5E5;

      --color-canopy: #2D5A3D;
      --color-small-tree: #3D7A4D;
      --color-tall-shrub: #4D9A5D;
      --color-low-shrub: #6DB66D;
      --color-ground: #8DD68D;

      --font-heading: 'Zilla Slab', Georgia, serif;
      --font-body: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --font-mono: 'JetBrains Mono', 'Fira Code', monospace;

      --space-xs: 0.5rem;
      --space-sm: 1rem;
      --space-md: 1.5rem;
      --space-lg: 2.5rem;
      --space-xl: 4rem;

      --radius-sm: 4px;
      --radius-md: 8px;

      --transition-fast: 150ms ease;
      --transition-base: 250ms ease;
    }

    /* ==========================================================================
       Base Styles
       ========================================================================== */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    html {
      font-size: 16px;
      -webkit-text-size-adjust: 100%;
    }

    body {
      margin: 0;
      font-family: var(--font-body);
      font-size: 1rem;
      line-height: 1.6;
      color: var(--color-text);
      background-color: var(--color-bg);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ==========================================================================
       Header
       ========================================================================== */
    .site-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-sm) var(--space-md);
      border-bottom: 1px solid var(--color-border);
    }

    .site-brand {
      font-family: var(--font-heading);
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--color-text);
      text-decoration: none;
      transition: color var(--transition-fast);
    }

    .site-brand:hover {
      color: var(--color-muted);
    }

    .header-meta {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .tool-label {
      font-family: var(--font-mono);
      font-size: 0.6875rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-muted);
    }

    .reset-link {
      font-family: var(--font-mono);
      font-size: 0.6875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-muted);
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      transition: color var(--transition-fast), background-color var(--transition-fast);
      opacity: 0;
      pointer-events: none;
    }

    .reset-link.is-visible {
      opacity: 1;
      pointer-events: auto;
    }

    .reset-link:hover {
      color: var(--color-text);
      background-color: var(--color-bg-alt);
    }

    /* ==========================================================================
       Main Container
       ========================================================================== */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 720px;
      width: 100%;
      margin: 0 auto;
      padding: var(--space-lg) var(--space-md);
    }

    /* ==========================================================================
       Tool Container
       ========================================================================== */
    .tool {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    /* ==========================================================================
       Input Section
       ========================================================================== */
    .input-section {
      margin-bottom: var(--space-lg);
    }

    .input-title {
      font-family: var(--font-heading);
      font-size: 1.75rem;
      font-weight: 700;
      margin: 0 0 var(--space-xs) 0;
    }

    .input-subtitle {
      font-size: 0.9375rem;
      color: var(--color-muted);
      margin: 0 0 var(--space-md) 0;
    }

    .input-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-md);
    }

    @media (max-width: 520px) {
      .input-grid {
        grid-template-columns: 1fr;
      }
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    .input-label {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-muted);
    }

    .input-text {
      font-family: var(--font-body);
      font-size: 1rem;
      padding: 0.75rem 1rem;
      border: 2px solid var(--color-border);
      border-radius: var(--radius-sm);
      background: var(--color-bg);
      color: var(--color-text);
      transition: border-color var(--transition-fast);
    }

    .input-text:focus {
      outline: none;
      border-color: var(--color-text);
    }

    .input-text.is-invalid {
      border-color: #DC2626;
    }

    .input-help {
      font-size: 0.8125rem;
      color: var(--color-muted);
    }

    .input-error {
      font-size: 0.8125rem;
      color: #DC2626;
      display: none;
    }

    .input-error.is-visible {
      display: block;
    }

    /* Sun Slider */
    .sun-slider-container {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    .sun-slider-value {
      font-family: var(--font-body);
      font-size: 0.9375rem;
      font-weight: 500;
      color: var(--color-text);
      min-height: 1.5rem;
    }

    .sun-slider-track {
      position: relative;
      width: 100%;
      padding: 0.5rem 0;
    }

    .sun-slider-input {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      background: linear-gradient(to right, #6B7280 0%, var(--color-accent) 100%);
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }

    .sun-slider-input::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      background: var(--color-text);
      border-radius: 50%;
      cursor: grab;
      border: 3px solid var(--color-bg);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transition: transform var(--transition-fast);
    }

    .sun-slider-input::-webkit-slider-thumb:hover {
      transform: scale(1.1);
    }

    .sun-slider-input::-moz-range-thumb {
      width: 24px;
      height: 24px;
      background: var(--color-text);
      border-radius: 50%;
      cursor: grab;
      border: 3px solid var(--color-bg);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .sun-slider-ticks {
      display: flex;
      justify-content: space-between;
      font-family: var(--font-mono);
      font-size: 0.6875rem;
      color: var(--color-muted);
    }

    /* Find Plants Button */
    .find-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-family: var(--font-mono);
      font-size: 0.875rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 1rem 1.5rem;
      border: 2px solid var(--color-text);
      background-color: var(--color-text);
      color: var(--color-bg);
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
      margin-top: var(--space-md);
    }

    .find-btn:hover {
      background-color: var(--color-accent);
      border-color: var(--color-accent);
      color: var(--color-text);
    }

    .find-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ==========================================================================
       Results Section
       ========================================================================== */
    .results-section {
      opacity: 1;
      transition: opacity var(--transition-base);
    }

    .results-section.is-hidden {
      display: none;
    }

    .results-section.is-transitioning {
      opacity: 0;
    }

    .results-header {
      margin-bottom: var(--space-md);
    }

    .results-title {
      font-family: var(--font-heading);
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 var(--space-xs) 0;
    }

    .results-meta {
      font-size: 0.875rem;
      color: var(--color-muted);
      margin: 0;
    }

    .region-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      font-family: var(--font-mono);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.375rem 0.75rem;
      background: var(--color-bg-alt);
      border-radius: var(--radius-sm);
      margin-top: var(--space-xs);
    }

    /* ==========================================================================
       Landscape Visualization
       ========================================================================== */
    .landscape-section {
      margin-bottom: var(--space-lg);
    }

    .landscape-title {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-muted);
      margin: 0 0 var(--space-sm) 0;
    }

    .landscape-container {
      position: relative;
      background: linear-gradient(to bottom, #E0F4FF 0%, #B8E6FF 30%, #90D8FF 100%);
      border-radius: var(--radius-md);
      overflow: hidden;
      height: 280px;
      border: 1px solid var(--color-border);
    }

    .landscape-ground {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 20px;
      background: linear-gradient(to bottom, #8B7355 0%, #6B5344 100%);
    }

    .landscape-layers {
      position: absolute;
      bottom: 20px;
      left: 0;
      right: 0;
      top: 0;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding: 0 var(--space-sm);
      gap: 2px;
    }

    .plant-silhouette {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: transform var(--transition-fast), filter var(--transition-fast);
      position: relative;
    }

    .plant-silhouette:hover {
      transform: translateY(-4px);
      filter: brightness(1.1);
    }

    .plant-silhouette.is-active {
      filter: brightness(1.2);
    }

    .plant-shape {
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      transition: all var(--transition-fast);
    }

    .plant-shape--canopy {
      background: var(--color-canopy);
    }

    .plant-shape--small-tree {
      background: var(--color-small-tree);
    }

    .plant-shape--tall-shrub {
      background: var(--color-tall-shrub);
    }

    .plant-shape--low-shrub {
      background: var(--color-low-shrub);
    }

    .plant-shape--ground {
      background: var(--color-ground);
    }

    .plant-stem {
      width: 3px;
      background: #5D4E3A;
      margin-top: -2px;
    }

    /* Layer Legend */
    .layer-legend {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-xs);
      margin-top: var(--space-sm);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.75rem;
      color: var(--color-muted);
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    /* ==========================================================================
       Plant Cards
       ========================================================================== */
    .plants-section {
      margin-bottom: var(--space-lg);
    }

    .plants-category {
      margin-bottom: var(--space-lg);
    }

    .category-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-sm);
      padding-bottom: var(--space-xs);
      border-bottom: 1px solid var(--color-border);
    }

    .category-title {
      font-family: var(--font-heading);
      font-size: 1.125rem;
      font-weight: 600;
      margin: 0;
    }

    .category-count {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: var(--color-muted);
    }

    .plants-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--space-sm);
    }

    .plant-card {
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
      cursor: pointer;
    }

    .plant-card:hover {
      border-color: var(--color-text);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .plant-card.is-expanded {
      border-color: var(--color-text);
    }

    .plant-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--space-sm);
      margin-bottom: var(--space-xs);
    }

    .plant-name {
      font-family: var(--font-heading);
      font-size: 1rem;
      font-weight: 600;
      margin: 0;
      line-height: 1.3;
    }

    .plant-scientific {
      font-size: 0.8125rem;
      font-style: italic;
      color: var(--color-muted);
      margin: 0 0 var(--space-xs) 0;
    }

    .plant-bloom {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-family: var(--font-mono);
      font-size: 0.6875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      white-space: nowrap;
    }

    .bloom-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .plant-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.375rem;
      margin-bottom: var(--space-sm);
    }

    .plant-tag {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      background: var(--color-bg-alt);
      border-radius: var(--radius-sm);
    }

    .plant-details {
      display: none;
      padding-top: var(--space-sm);
      border-top: 1px solid var(--color-border);
      margin-top: var(--space-sm);
    }

    .plant-card.is-expanded .plant-details {
      display: block;
    }

    .plant-description {
      font-size: 0.875rem;
      line-height: 1.6;
      color: var(--color-muted);
      margin: 0 0 var(--space-sm) 0;
    }

    .plant-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-xs);
    }

    .plant-stat {
      display: flex;
      flex-direction: column;
      gap: 0.125rem;
    }

    .stat-label {
      font-family: var(--font-mono);
      font-size: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-muted);
    }

    .stat-value {
      font-size: 0.8125rem;
      font-weight: 500;
    }

    /* ==========================================================================
       Nurseries Section
       ========================================================================== */
    .nurseries-section {
      margin-bottom: var(--space-lg);
      padding: var(--space-md);
      background: var(--color-bg-alt);
      border-radius: var(--radius-md);
    }

    .nurseries-title {
      font-family: var(--font-heading);
      font-size: 1.125rem;
      font-weight: 600;
      margin: 0 0 var(--space-sm) 0;
    }

    .nurseries-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .nursery-item {
      padding: var(--space-xs) 0;
      border-bottom: 1px solid var(--color-border);
    }

    .nursery-item:last-child {
      border-bottom: none;
    }

    .nursery-name {
      font-weight: 500;
      margin-bottom: 0.125rem;
    }

    .nursery-name a {
      color: var(--color-text);
      text-decoration: none;
      border-bottom: 1px solid var(--color-border);
      transition: border-color var(--transition-fast);
    }

    .nursery-name a:hover {
      border-color: var(--color-text);
    }

    .nursery-address {
      font-size: 0.8125rem;
      color: var(--color-muted);
    }

    /* ==========================================================================
       Export Section
       ========================================================================== */
    .export-section {
      display: flex;
      gap: var(--space-sm);
      padding-top: var(--space-md);
      border-top: 1px solid var(--color-border);
    }

    .export-btn {
      flex: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-family: var(--font-mono);
      font-size: 0.8125rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.875rem 1.25rem;
      border: 2px solid var(--color-text);
      background-color: var(--color-text);
      color: var(--color-bg);
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
    }

    .export-btn:hover {
      background-color: var(--color-accent);
      border-color: var(--color-accent);
      color: var(--color-text);
    }

    .export-btn--secondary {
      background-color: transparent;
      color: var(--color-text);
    }

    .export-btn--secondary:hover {
      background-color: var(--color-text);
      color: var(--color-bg);
    }

    /* ==========================================================================
       Unsupported Region Message
       ========================================================================== */
    .unsupported-message {
      text-align: center;
      padding: var(--space-xl) var(--space-md);
      background: var(--color-bg-alt);
      border-radius: var(--radius-md);
    }

    .unsupported-title {
      font-family: var(--font-heading);
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0 0 var(--space-sm) 0;
    }

    .unsupported-text {
      color: var(--color-muted);
      margin: 0 0 var(--space-md) 0;
    }

    .unsupported-link {
      color: var(--color-text);
      font-weight: 500;
    }

    /* ==========================================================================
       Footer
       ========================================================================== */
    .site-footer {
      padding: var(--space-sm) var(--space-md);
      text-align: center;
      font-size: 0.75rem;
      color: var(--color-muted);
    }

    .privacy-note {
      margin: 0;
    }

    .data-source {
      margin: var(--space-xs) 0 0 0;
    }

    .data-source a {
      color: var(--color-muted);
      text-decoration: none;
      border-bottom: 1px solid var(--color-border);
    }

    .data-source a:hover {
      color: var(--color-text);
    }

    /* ==========================================================================
       Responsive Adjustments
       ========================================================================== */
    @media (max-width: 480px) {
      .site-header {
        padding: var(--space-xs) var(--space-sm);
      }

      main {
        padding: var(--space-md) var(--space-sm);
      }

      .input-title {
        font-size: 1.5rem;
      }

      .landscape-container {
        height: 200px;
      }

      .plants-grid {
        grid-template-columns: 1fr;
      }

      .export-section {
        flex-direction: column;
      }
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */
    @media (prefers-reduced-motion: reduce) {
      .plant-silhouette,
      .plant-card,
      .results-section {
        transition: none;
      }
    }

    /* ==========================================================================
       Print Styles
       ========================================================================== */
    @media print {
      body {
        background: white;
      }

      .site-header,
      .site-footer,
      .export-section,
      .reset-link,
      .find-btn,
      .input-section {
        display: none !important;
      }

      main {
        max-width: 100%;
        padding: 0;
      }

      .plant-card {
        break-inside: avoid;
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <a href="index.html" class="site-brand" aria-label="Return to home">BS.</a>
    <div class="header-meta">
      <span class="tool-label">Native Plant Finder</span>
      <button class="reset-link" id="header-reset" type="button">Start over</button>
    </div>
  </header>

  <main>
    <div class="tool" id="tool" role="application" aria-label="Native Plant Finder tool">
      <!-- Input Section -->
      <section class="input-section" id="input-section">
        <h1 class="input-title">Find Native Plants</h1>
        <p class="input-subtitle">Enter your location and sun conditions to discover native plants that will thrive in your garden.</p>

        <div class="input-grid">
          <div class="input-group">
            <label class="input-label" for="zip-input">Zip Code</label>
            <input
              type="text"
              class="input-text"
              id="zip-input"
              placeholder="94402"
              maxlength="5"
              inputmode="numeric"
              pattern="[0-9]*"
              aria-describedby="zip-help zip-error"
            >
            <span class="input-help" id="zip-help">Currently supporting San Mateo area (94402)</span>
            <span class="input-error" id="zip-error" role="alert">Please enter a valid 5-digit zip code</span>
          </div>

          <div class="input-group">
            <label class="input-label" for="sun-input">Sun Exposure</label>
            <div class="sun-slider-container">
              <div class="sun-slider-value" id="sun-value">Part Sun (4-6 hrs)</div>
              <div class="sun-slider-track">
                <input
                  type="range"
                  class="sun-slider-input"
                  id="sun-input"
                  min="1"
                  max="4"
                  value="3"
                  aria-label="Sun exposure level"
                  aria-valuemin="1"
                  aria-valuemax="4"
                  aria-valuenow="3"
                >
              </div>
              <div class="sun-slider-ticks">
                <span>Shade</span>
                <span>Full Sun</span>
              </div>
            </div>
          </div>
        </div>

        <button type="button" class="find-btn" id="find-btn">Find Plants</button>
      </section>

      <!-- Results Section (hidden initially) -->
      <section class="results-section is-hidden" id="results-section">
        <!-- Populated by JavaScript -->
      </section>
    </div>
  </main>

  <footer class="site-footer">
    <p class="privacy-note">Nothing is saved. All data stays in your browser.</p>
    <p class="data-source">Plant data sourced from <a href="https://calscape.org" target="_blank" rel="noopener">Calscape.org</a> / California Native Plant Society</p>
  </footer>

  <script>
    (function() {
      // ==========================================================================
      // Plant Database
      // ==========================================================================
      var PLANT_DATA = {
        meta: {
          version: "1.0.0",
          lastUpdated: "2025-01-16",
          source: "Calscape.org / California Native Plant Society"
        },
        regions: {
          "94402": {
            name: "San Mateo, CA",
            ecoregion: "Central Coast - California Floristic Province",
            usdaZone: "10a",
            rainfallInches: 20,
            notes: "Mediterranean climate with dry summers, mild wet winters. Coastal influence moderates temperatures."
          }
        },
        heightCategories: {
          ground_cover: { label: "Ground Cover", range: "Under 3 ft", order: 0 },
          low_shrub: { label: "Low Shrubs", range: "2-6 ft", order: 1 },
          tall_shrub: { label: "Tall Shrubs", range: "5-12 ft", order: 2 },
          small_tree: { label: "Small Trees", range: "10-25 ft", order: 3 },
          canopy_tree: { label: "Canopy Trees", range: "25+ ft", order: 4 }
        },
        sunLevels: {
          1: { label: "Full Shade", description: "Less than 2 hours direct sun" },
          2: { label: "Part Shade", description: "2-4 hours direct sun" },
          3: { label: "Part Sun", description: "4-6 hours direct sun" },
          4: { label: "Full Sun", description: "6+ hours direct sun" }
        },
        waterNeeds: {
          very_low: "Very Low",
          low: "Low",
          moderate: "Moderate"
        },
        bloomColors: {
          white: "#FAFAFA",
          yellow: "#FCD34D",
          orange: "#FB923C",
          "orange-red": "#F97316",
          magenta: "#DB2777",
          purple: "#A855F7",
          "blue-purple": "#8B5CF6",
          pink: "#F472B6",
          "pink-red": "#F43F5E",
          "pink-white": "#FDF2F8",
          "white-pink": "#FCE7F3",
          "white-lavender": "#EDE9FE",
          "yellow-green": "#BEF264",
          green: "#86EFAC"
        },
        plants: [
          {
            id: "yarrow",
            commonName: "Common Yarrow",
            scientificName: "Achillea millefolium",
            heightCategory: "ground_cover",
            heightInches: { min: 12, max: 36 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["pollinators", "butterflies", "beneficial_insects"],
            bloomSeason: ["spring", "summer"],
            bloomColor: "white",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 36,
            regions: ["94402"],
            description: "Feathery, aromatic foliage with flat-topped flower clusters. Extremely drought tolerant once established. Spreads to form dense mats."
          },
          {
            id: "california_fuchsia",
            commonName: "California Fuchsia",
            scientificName: "Epilobium canum",
            heightCategory: "ground_cover",
            heightInches: { min: 12, max: 24 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["hummingbirds", "pollinators"],
            bloomSeason: ["summer", "fall"],
            bloomColor: "orange-red",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 36,
            regions: ["94402"],
            description: "Brilliant tubular flowers attract hummingbirds late in the season when little else blooms. Gray-green foliage."
          },
          {
            id: "beach_strawberry",
            commonName: "Beach Strawberry",
            scientificName: "Fragaria chiloensis",
            heightCategory: "ground_cover",
            heightInches: { min: 4, max: 8 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["birds", "pollinators", "erosion_control"],
            bloomSeason: ["spring"],
            bloomColor: "white",
            difficulty: "easy",
            deerResistant: false,
            spreadInches: 24,
            regions: ["94402"],
            description: "Excellent evergreen groundcover with glossy leaves, white flowers, and small edible fruit. Parent species of commercial strawberries."
          },
          {
            id: "douglas_iris",
            commonName: "Douglas Iris",
            scientificName: "Iris douglasiana",
            heightCategory: "ground_cover",
            heightInches: { min: 12, max: 24 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["pollinators"],
            bloomSeason: ["spring"],
            bloomColor: "purple",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 24,
            regions: ["94402"],
            description: "Elegant sword-like foliage with purple to blue flowers in spring. Tolerates a wide range of conditions including clay soil."
          },
          {
            id: "coast_buckwheat",
            commonName: "Coast Buckwheat",
            scientificName: "Eriogonum latifolium",
            heightCategory: "ground_cover",
            heightInches: { min: 12, max: 24 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["pollinators", "butterflies", "beneficial_insects", "birds"],
            bloomSeason: ["summer", "fall"],
            bloomColor: "pink-white",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 36,
            regions: ["94402"],
            description: "Powerhouse pollinator plant. Long-lasting flower heads age from white to rose to rust. Host plant for several butterfly species."
          },
          {
            id: "hummingbird_sage",
            commonName: "Hummingbird Sage",
            scientificName: "Salvia spathacea",
            heightCategory: "ground_cover",
            heightInches: { min: 12, max: 36 },
            sunMin: 1,
            sunMax: 3,
            waterNeeds: "low",
            ecologicalValue: ["hummingbirds", "pollinators"],
            bloomSeason: ["spring"],
            bloomColor: "magenta",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 36,
            regions: ["94402"],
            description: "One of the best shade-tolerant natives. Large aromatic leaves and magenta flower spikes. Spreads by rhizomes to form colonies."
          },
          {
            id: "california_sagebrush",
            commonName: "California Sagebrush",
            scientificName: "Artemisia californica",
            heightCategory: "low_shrub",
            heightInches: { min: 24, max: 60 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["birds", "beneficial_insects"],
            bloomSeason: ["fall"],
            bloomColor: "yellow",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 72,
            regions: ["94402"],
            description: "Aromatic silvery-green foliage with that classic California coastal sage scent. Virtually indestructible once established."
          },
          {
            id: "coyote_brush",
            commonName: "Coyote Brush",
            scientificName: "Baccharis pilularis",
            heightCategory: "low_shrub",
            heightInches: { min: 12, max: 96 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["pollinators", "birds", "butterflies", "erosion_control"],
            bloomSeason: ["fall", "winter"],
            bloomColor: "white",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 72,
            regions: ["94402"],
            description: "Workhorse native shrub. Dwarf forms available for groundcover. Pioneer species that establishes easily and supports dozens of insect species."
          },
          {
            id: "sticky_monkey",
            commonName: "Sticky Monkeyflower",
            scientificName: "Diplacus aurantiacus",
            heightCategory: "low_shrub",
            heightInches: { min: 24, max: 48 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["hummingbirds", "pollinators"],
            bloomSeason: ["spring", "summer"],
            bloomColor: "orange",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 48,
            regions: ["94402"],
            description: "Cheerful orange tubular flowers bloom for months. Tolerates poor soil and drought. Hummingbird magnet."
          },
          {
            id: "salvia_clevelandii",
            commonName: "Cleveland Sage",
            scientificName: "Salvia clevelandii",
            heightCategory: "low_shrub",
            heightInches: { min: 36, max: 60 },
            sunMin: 4,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["hummingbirds", "pollinators", "butterflies"],
            bloomSeason: ["spring", "summer"],
            bloomColor: "blue-purple",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 60,
            regions: ["94402"],
            description: "Intensely fragrant gray-green foliage. Whorls of blue-violet flowers loved by hummingbirds. Requires excellent drainage."
          },
          {
            id: "black_sage",
            commonName: "Black Sage",
            scientificName: "Salvia mellifera",
            heightCategory: "low_shrub",
            heightInches: { min: 36, max: 72 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["pollinators", "birds", "beneficial_insects"],
            bloomSeason: ["spring", "summer"],
            bloomColor: "white-lavender",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 72,
            regions: ["94402"],
            description: "Major honey-producing plant. Aromatic foliage goes dormant in summer drought. Essential coastal sage scrub species."
          },
          {
            id: "coffeeberry",
            commonName: "California Coffeeberry",
            scientificName: "Frangula californica",
            heightCategory: "tall_shrub",
            heightInches: { min: 72, max: 144 },
            sunMin: 1,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["birds", "pollinators"],
            bloomSeason: ["spring"],
            bloomColor: "green",
            difficulty: "easy",
            deerResistant: false,
            spreadInches: 96,
            regions: ["94402"],
            description: "Versatile evergreen shrub tolerating sun to full shade. Berries ripen from green to red to black, attracting birds. Dwarf cultivars available."
          },
          {
            id: "toyon",
            commonName: "Toyon",
            scientificName: "Heteromeles arbutifolia",
            heightCategory: "tall_shrub",
            heightInches: { min: 72, max: 180 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["birds", "pollinators"],
            bloomSeason: ["summer"],
            bloomColor: "white",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 120,
            regions: ["94402"],
            description: "The plant that gave Hollywood its name. Bright red winter berries attract birds. Can be trained as small tree or kept as shrub."
          },
          {
            id: "red_flowering_currant",
            commonName: "Red Flowering Currant",
            scientificName: "Ribes sanguineum",
            heightCategory: "tall_shrub",
            heightInches: { min: 60, max: 120 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["hummingbirds", "pollinators", "birds"],
            bloomSeason: ["winter", "spring"],
            bloomColor: "pink-red",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 72,
            regions: ["94402"],
            description: "One of the first plants to bloom in late winter. Drooping clusters of pink flowers are critical early hummingbird food. Blue berries follow."
          },
          {
            id: "manzanita",
            commonName: "Common Manzanita",
            scientificName: "Arctostaphylos manzanita",
            heightCategory: "tall_shrub",
            heightInches: { min: 72, max: 144 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["pollinators", "birds"],
            bloomSeason: ["winter", "spring"],
            bloomColor: "white-pink",
            difficulty: "moderate",
            deerResistant: true,
            spreadInches: 96,
            regions: ["94402"],
            description: "Beautiful red bark and urn-shaped flowers. Many cultivars available from groundcover to tree-sized. Critical early pollinator food."
          },
          {
            id: "western_redbud",
            commonName: "Western Redbud",
            scientificName: "Cercis occidentalis",
            heightCategory: "small_tree",
            heightInches: { min: 120, max: 240 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["pollinators", "birds"],
            bloomSeason: ["spring"],
            bloomColor: "magenta",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 180,
            regions: ["94402"],
            description: "Stunning spring display of magenta flowers on bare branches. Heart-shaped leaves turn yellow in fall. Multi-trunked form."
          },
          {
            id: "blue_elderberry",
            commonName: "Blue Elderberry",
            scientificName: "Sambucus nigra ssp. caerulea",
            heightCategory: "small_tree",
            heightInches: { min: 120, max: 300 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["birds", "pollinators", "butterflies"],
            bloomSeason: ["spring", "summer"],
            bloomColor: "white",
            difficulty: "easy",
            deerResistant: false,
            spreadInches: 180,
            regions: ["94402"],
            description: "Fast-growing with creamy flower clusters and blue berries beloved by birds. Berries edible when cooked. Important wildlife plant."
          },
          {
            id: "california_buckeye",
            commonName: "California Buckeye",
            scientificName: "Aesculus californica",
            heightCategory: "small_tree",
            heightInches: { min: 120, max: 300 },
            sunMin: 2,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["pollinators", "butterflies"],
            bloomSeason: ["spring"],
            bloomColor: "white-pink",
            difficulty: "moderate",
            deerResistant: true,
            spreadInches: 240,
            regions: ["94402"],
            description: "Distinctive deciduous tree with fragrant flower spikes. Drops leaves in summer drought, revealing silvery bark. Toxic to honeybees."
          },
          {
            id: "coast_live_oak",
            commonName: "Coast Live Oak",
            scientificName: "Quercus agrifolia",
            heightCategory: "canopy_tree",
            heightInches: { min: 240, max: 600 },
            sunMin: 3,
            sunMax: 4,
            waterNeeds: "very_low",
            ecologicalValue: ["birds", "butterflies", "beneficial_insects"],
            bloomSeason: ["spring"],
            bloomColor: "yellow",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 600,
            regions: ["94402"],
            description: "Iconic California tree supporting 300+ species of insects and wildlife. Long-lived. Do not irrigate established trees in summer."
          },
          {
            id: "california_bay_laurel",
            commonName: "California Bay Laurel",
            scientificName: "Umbellularia californica",
            heightCategory: "canopy_tree",
            heightInches: { min: 240, max: 600 },
            sunMin: 1,
            sunMax: 4,
            waterNeeds: "low",
            ecologicalValue: ["birds", "pollinators"],
            bloomSeason: ["winter", "spring"],
            bloomColor: "yellow-green",
            difficulty: "easy",
            deerResistant: true,
            spreadInches: 480,
            regions: ["94402"],
            description: "Aromatic evergreen leaves used in cooking (stronger than Mediterranean bay). Tolerates heavy shade. Can cause sudden oak death if planted near oaks."
          }
        ],
        nurseries: [
          {
            name: "Yerba Buena Nursery",
            address: "19500 Skyline Blvd, Woodside, CA",
            url: "https://www.yerbabuenanursery.com",
            notes: "Local to Peninsula, specializes in natives"
          },
          {
            name: "Mostly Natives Nursery",
            address: "27235 Highway 1, Tomales, CA",
            url: "https://www.mostlynatives.com",
            notes: "Excellent selection of locally-sourced natives"
          },
          {
            name: "California Flora Nursery",
            address: "2990 Somers St, Fulton, CA",
            url: "https://www.calfloranursery.com",
            notes: "Wide variety of California natives"
          }
        ],
        ecologicalIcons: {
          pollinators: "Pollinators",
          hummingbirds: "Hummingbirds",
          butterflies: "Butterflies",
          birds: "Birds",
          beneficial_insects: "Beneficial Insects",
          erosion_control: "Erosion Control"
        }
      };

      // ==========================================================================
      // DOM Elements
      // ==========================================================================
      var tool = document.getElementById('tool');
      var headerReset = document.getElementById('header-reset');
      var inputSection = document.getElementById('input-section');
      var resultsSection = document.getElementById('results-section');
      var zipInput = document.getElementById('zip-input');
      var zipError = document.getElementById('zip-error');
      var sunInput = document.getElementById('sun-input');
      var sunValue = document.getElementById('sun-value');
      var findBtn = document.getElementById('find-btn');

      // ==========================================================================
      // State
      // ==========================================================================
      var state = {
        zipCode: '',
        sunLevel: 3,
        region: null,
        filteredPlants: [],
        expandedPlantId: null
      };

      // ==========================================================================
      // Helpers
      // ==========================================================================
      function validateZip(zip) {
        return /^\d{5}$/.test(zip);
      }

      function isRegionSupported(zip) {
        return PLANT_DATA.regions.hasOwnProperty(zip);
      }

      function filterPlants(zip, sunLevel) {
        return PLANT_DATA.plants.filter(function(plant) {
          var inRegion = plant.regions.indexOf(zip) !== -1;
          var sunMatch = sunLevel >= plant.sunMin && sunLevel <= plant.sunMax;
          return inRegion && sunMatch;
        });
      }

      function groupByCategory(plants) {
        var groups = {};
        plants.forEach(function(plant) {
          var cat = plant.heightCategory;
          if (!groups[cat]) {
            groups[cat] = [];
          }
          groups[cat].push(plant);
        });
        return groups;
      }

      function formatHeight(inches) {
        if (inches.max < 12) {
          return inches.min + '-' + inches.max + '"';
        }
        var minFt = Math.floor(inches.min / 12);
        var maxFt = Math.ceil(inches.max / 12);
        if (minFt === maxFt) {
          return minFt + ' ft';
        }
        return minFt + '-' + maxFt + ' ft';
      }

      function formatSeason(seasons) {
        return seasons.map(function(s) {
          return s.charAt(0).toUpperCase() + s.slice(1);
        }).join(', ');
      }

      function getSunLabel(level) {
        var labels = {
          1: "Full Shade (< 2 hrs)",
          2: "Part Shade (2-4 hrs)",
          3: "Part Sun (4-6 hrs)",
          4: "Full Sun (6+ hrs)"
        };
        return labels[level] || '';
      }

      // ==========================================================================
      // Sun Slider
      // ==========================================================================
      sunInput.addEventListener('input', function() {
        state.sunLevel = parseInt(sunInput.value, 10);
        sunValue.textContent = getSunLabel(state.sunLevel);
        sunInput.setAttribute('aria-valuenow', state.sunLevel);
      });

      // ==========================================================================
      // Zip Input
      // ==========================================================================
      zipInput.addEventListener('input', function() {
        var value = zipInput.value.replace(/\D/g, '').slice(0, 5);
        zipInput.value = value;
        state.zipCode = value;

        // Clear error state
        zipInput.classList.remove('is-invalid');
        zipError.classList.remove('is-visible');
      });

      zipInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          findBtn.click();
        }
      });

      // ==========================================================================
      // Find Plants Button
      // ==========================================================================
      findBtn.addEventListener('click', function() {
        var zip = state.zipCode;

        // Validate
        if (!validateZip(zip)) {
          zipInput.classList.add('is-invalid');
          zipError.classList.add('is-visible');
          zipInput.focus();
          return;
        }

        // Find plants and show results
        state.region = PLANT_DATA.regions[zip] || null;
        state.filteredPlants = filterPlants(zip, state.sunLevel);
        showResults();
      });

      // ==========================================================================
      // Header Reset
      // ==========================================================================
      headerReset.addEventListener('click', function() {
        resetTool();
      });

      function resetTool() {
        state.zipCode = '';
        state.sunLevel = 3;
        state.region = null;
        state.filteredPlants = [];
        state.expandedPlantId = null;

        zipInput.value = '';
        sunInput.value = 3;
        sunValue.textContent = getSunLabel(3);
        zipInput.classList.remove('is-invalid');
        zipError.classList.remove('is-visible');

        resultsSection.classList.add('is-hidden');
        inputSection.style.display = '';
        headerReset.classList.remove('is-visible');
      }

      // ==========================================================================
      // Show Results
      // ==========================================================================
      function showResults() {
        headerReset.classList.add('is-visible');

        if (!isRegionSupported(state.zipCode)) {
          renderUnsupportedRegion();
        } else {
          renderResults();
        }

        resultsSection.classList.remove('is-hidden');
      }

      // ==========================================================================
      // Render Unsupported Region
      // ==========================================================================
      function renderUnsupportedRegion() {
        var html = '' +
          '<div class="unsupported-message">' +
            '<h2 class="unsupported-title">Region Not Yet Supported</h2>' +
            '<p class="unsupported-text">' +
              'We currently only have plant data for the San Mateo, CA area (94402). ' +
              'We\'re working on expanding to more regions.' +
            '</p>' +
            '<p class="unsupported-text">' +
              'In the meantime, try <a href="https://calscape.org" target="_blank" rel="noopener" class="unsupported-link">Calscape.org</a> ' +
              'to find native plants for your California location.' +
            '</p>' +
            '<button type="button" class="find-btn" id="try-again-btn">Try Another Zip</button>' +
          '</div>';

        resultsSection.innerHTML = html;

        document.getElementById('try-again-btn').addEventListener('click', function() {
          resetTool();
          zipInput.focus();
        });
      }

      // ==========================================================================
      // Render Results
      // ==========================================================================
      function renderResults() {
        var region = state.region;
        var plants = state.filteredPlants;
        var grouped = groupByCategory(plants);

        var html = '' +
          '<div class="results-header">' +
            '<h2 class="results-title">' + plants.length + ' Native Plants for Your Garden</h2>' +
            '<p class="results-meta">Filtered for ' + getSunLabel(state.sunLevel).toLowerCase() + ' conditions</p>' +
            '<div class="region-badge">' +
              '<span>' + region.name + '</span>' +
              '<span>·</span>' +
              '<span>USDA Zone ' + region.usdaZone + '</span>' +
            '</div>' +
          '</div>';

        // Landscape Visualization
        html += renderLandscape(plants);

        // Plant Cards by Category
        html += '<div class="plants-section">';

        var categoryOrder = ['canopy_tree', 'small_tree', 'tall_shrub', 'low_shrub', 'ground_cover'];
        categoryOrder.forEach(function(catKey) {
          if (grouped[catKey] && grouped[catKey].length > 0) {
            html += renderCategory(catKey, grouped[catKey]);
          }
        });

        html += '</div>';

        // Nurseries
        html += renderNurseries();

        // Export Section
        html += '' +
          '<div class="export-section">' +
            '<button type="button" class="export-btn" id="export-pdf-btn">Download PDF</button>' +
            '<button type="button" class="export-btn export-btn--secondary" id="print-btn">Print</button>' +
          '</div>';

        resultsSection.innerHTML = html;

        // Attach event listeners
        attachPlantCardListeners();
        attachExportListeners();
        attachLandscapeListeners();
      }

      // ==========================================================================
      // Landscape Visualization
      // ==========================================================================
      function renderLandscape(plants) {
        var html = '' +
          '<div class="landscape-section">' +
            '<h3 class="landscape-title">Your Native Landscape</h3>' +
            '<div class="landscape-container" id="landscape">' +
              '<div class="landscape-layers" id="landscape-layers"></div>' +
              '<div class="landscape-ground"></div>' +
            '</div>' +
            '<div class="layer-legend">' +
              '<div class="legend-item"><div class="legend-dot" style="background: var(--color-canopy)"></div><span>Canopy</span></div>' +
              '<div class="legend-item"><div class="legend-dot" style="background: var(--color-small-tree)"></div><span>Small Tree</span></div>' +
              '<div class="legend-item"><div class="legend-dot" style="background: var(--color-tall-shrub)"></div><span>Tall Shrub</span></div>' +
              '<div class="legend-item"><div class="legend-dot" style="background: var(--color-low-shrub)"></div><span>Low Shrub</span></div>' +
              '<div class="legend-item"><div class="legend-dot" style="background: var(--color-ground)"></div><span>Ground Cover</span></div>' +
            '</div>' +
          '</div>';

        return html;
      }

      function buildLandscapePlants() {
        var layers = document.getElementById('landscape-layers');
        if (!layers) return;

        layers.innerHTML = '';

        var plants = state.filteredPlants;

        // Scale factors for heights (container is ~260px usable)
        var maxContainerHeight = 240;
        var categoryHeights = {
          canopy_tree: { height: maxContainerHeight, width: 120 },
          small_tree: { height: 160, width: 80 },
          tall_shrub: { height: 100, width: 60 },
          low_shrub: { height: 60, width: 50 },
          ground_cover: { height: 30, width: 40 }
        };

        // Sort plants by height category (tallest first for z-index layering)
        var sorted = plants.slice().sort(function(a, b) {
          var orderA = PLANT_DATA.heightCategories[a.heightCategory].order;
          var orderB = PLANT_DATA.heightCategories[b.heightCategory].order;
          return orderB - orderA;
        });

        // Take a sample of plants for the visualization (max ~12)
        var sample = [];
        var categories = ['canopy_tree', 'small_tree', 'tall_shrub', 'low_shrub', 'ground_cover'];
        categories.forEach(function(cat) {
          var catPlants = sorted.filter(function(p) { return p.heightCategory === cat; });
          sample = sample.concat(catPlants.slice(0, 3));
        });

        sample.forEach(function(plant, index) {
          var dims = categoryHeights[plant.heightCategory];
          var colorClass = plant.heightCategory.replace('_', '-');

          var div = document.createElement('div');
          div.className = 'plant-silhouette';
          div.setAttribute('data-plant-id', plant.id);
          div.setAttribute('tabindex', '0');
          div.setAttribute('role', 'button');
          div.setAttribute('aria-label', plant.commonName);
          div.title = plant.commonName;

          // Randomize width slightly
          var widthVar = dims.width * (0.8 + Math.random() * 0.4);

          div.innerHTML = '' +
            '<div class="plant-shape plant-shape--' + colorClass + '" style="' +
              'width: ' + widthVar + 'px; ' +
              'height: ' + dims.height + 'px;' +
            '"></div>' +
            '<div class="plant-stem" style="height: ' + (dims.height * 0.15) + 'px;"></div>';

          layers.appendChild(div);
        });
      }

      function attachLandscapeListeners() {
        buildLandscapePlants();

        var layers = document.getElementById('landscape-layers');
        if (!layers) return;

        layers.addEventListener('click', function(e) {
          var silhouette = e.target.closest('.plant-silhouette');
          if (silhouette) {
            var plantId = silhouette.getAttribute('data-plant-id');
            scrollToPlantCard(plantId);
          }
        });
      }

      function scrollToPlantCard(plantId) {
        var card = document.querySelector('.plant-card[data-plant-id="' + plantId + '"]');
        if (card) {
          card.scrollIntoView({ behavior: 'smooth', block: 'center' });
          // Expand the card
          togglePlantCard(card);
          // Highlight briefly
          card.style.boxShadow = '0 0 0 3px var(--color-accent)';
          setTimeout(function() {
            card.style.boxShadow = '';
          }, 1500);
        }
      }

      // ==========================================================================
      // Render Category
      // ==========================================================================
      function renderCategory(categoryKey, plants) {
        var category = PLANT_DATA.heightCategories[categoryKey];

        var html = '' +
          '<div class="plants-category">' +
            '<div class="category-header">' +
              '<h3 class="category-title">' + category.label + '</h3>' +
              '<span class="category-count">' + plants.length + ' plant' + (plants.length !== 1 ? 's' : '') + ' · ' + category.range + '</span>' +
            '</div>' +
            '<div class="plants-grid">';

        plants.forEach(function(plant) {
          html += renderPlantCard(plant);
        });

        html += '</div></div>';
        return html;
      }

      // ==========================================================================
      // Render Plant Card
      // ==========================================================================
      function renderPlantCard(plant) {
        var bloomColor = PLANT_DATA.bloomColors[plant.bloomColor] || '#ccc';

        var tags = [];
        if (plant.waterNeeds) {
          tags.push(PLANT_DATA.waterNeeds[plant.waterNeeds] + ' Water');
        }
        if (plant.deerResistant) {
          tags.push('Deer Resistant');
        }
        if (plant.difficulty === 'easy') {
          tags.push('Easy');
        }

        var ecologyTags = plant.ecologicalValue.slice(0, 3).map(function(val) {
          return PLANT_DATA.ecologicalIcons[val] || val;
        });

        var html = '' +
          '<div class="plant-card" data-plant-id="' + plant.id + '" tabindex="0" role="button" aria-expanded="false">' +
            '<div class="plant-card-header">' +
              '<div>' +
                '<h4 class="plant-name">' + plant.commonName + '</h4>' +
                '<p class="plant-scientific">' + plant.scientificName + '</p>' +
              '</div>' +
              '<div class="plant-bloom" style="background: ' + bloomColor + '; color: ' + getContrastColor(bloomColor) + ';">' +
                '<span class="bloom-dot" style="background: ' + getContrastColor(bloomColor) + ';"></span>' +
                formatSeason(plant.bloomSeason) +
              '</div>' +
            '</div>' +
            '<div class="plant-tags">';

        tags.forEach(function(tag) {
          html += '<span class="plant-tag">' + tag + '</span>';
        });

        ecologyTags.forEach(function(tag) {
          html += '<span class="plant-tag">' + tag + '</span>';
        });

        html += '</div>' +
          '<div class="plant-details">' +
            '<p class="plant-description">' + plant.description + '</p>' +
            '<div class="plant-stats">' +
              '<div class="plant-stat">' +
                '<span class="stat-label">Height</span>' +
                '<span class="stat-value">' + formatHeight(plant.heightInches) + '</span>' +
              '</div>' +
              '<div class="plant-stat">' +
                '<span class="stat-label">Spread</span>' +
                '<span class="stat-value">' + Math.round(plant.spreadInches / 12) + ' ft</span>' +
              '</div>' +
              '<div class="plant-stat">' +
                '<span class="stat-label">Sun</span>' +
                '<span class="stat-value">' + formatSunRange(plant.sunMin, plant.sunMax) + '</span>' +
              '</div>' +
              '<div class="plant-stat">' +
                '<span class="stat-label">Water</span>' +
                '<span class="stat-value">' + PLANT_DATA.waterNeeds[plant.waterNeeds] + '</span>' +
              '</div>' +
            '</div>' +
          '</div>' +
        '</div>';

        return html;
      }

      function formatSunRange(min, max) {
        if (min === max) {
          return PLANT_DATA.sunLevels[min].label;
        }
        return PLANT_DATA.sunLevels[min].label.split(' ')[0] + ' to ' + PLANT_DATA.sunLevels[max].label.split(' ')[0];
      }

      function getContrastColor(hex) {
        // Simple contrast calculation
        var r = parseInt(hex.slice(1, 3), 16);
        var g = parseInt(hex.slice(3, 5), 16);
        var b = parseInt(hex.slice(5, 7), 16);
        var brightness = (r * 299 + g * 587 + b * 114) / 1000;
        return brightness > 128 ? '#1A1A1A' : '#FFFFFF';
      }

      // ==========================================================================
      // Plant Card Interactions
      // ==========================================================================
      function attachPlantCardListeners() {
        var cards = document.querySelectorAll('.plant-card');
        cards.forEach(function(card) {
          card.addEventListener('click', function() {
            togglePlantCard(card);
          });
          card.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              togglePlantCard(card);
            }
          });
        });
      }

      function togglePlantCard(card) {
        var wasExpanded = card.classList.contains('is-expanded');

        // Collapse all other cards
        document.querySelectorAll('.plant-card.is-expanded').forEach(function(c) {
          c.classList.remove('is-expanded');
          c.setAttribute('aria-expanded', 'false');
        });

        // Toggle this card
        if (!wasExpanded) {
          card.classList.add('is-expanded');
          card.setAttribute('aria-expanded', 'true');
          state.expandedPlantId = card.getAttribute('data-plant-id');
        } else {
          state.expandedPlantId = null;
        }
      }

      // ==========================================================================
      // Render Nurseries
      // ==========================================================================
      function renderNurseries() {
        var html = '' +
          '<div class="nurseries-section">' +
            '<h3 class="nurseries-title">Where to Buy Native Plants</h3>' +
            '<ul class="nurseries-list">';

        PLANT_DATA.nurseries.forEach(function(nursery) {
          html += '' +
            '<li class="nursery-item">' +
              '<div class="nursery-name"><a href="' + nursery.url + '" target="_blank" rel="noopener">' + nursery.name + '</a></div>' +
              '<div class="nursery-address">' + nursery.address + '</div>' +
            '</li>';
        });

        html += '</ul></div>';
        return html;
      }

      // ==========================================================================
      // Export Functionality
      // ==========================================================================
      function attachExportListeners() {
        document.getElementById('export-pdf-btn').addEventListener('click', generatePDF);
        document.getElementById('print-btn').addEventListener('click', function() {
          window.print();
        });
      }

      function generatePDF() {
        var jsPDF = window.jspdf.jsPDF;
        var doc = new jsPDF({
          orientation: 'portrait',
          unit: 'pt',
          format: 'letter'
        });

        var pageWidth = doc.internal.pageSize.getWidth();
        var margin = 40;
        var contentWidth = pageWidth - 2 * margin;
        var y = margin;

        // Title
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(20);
        doc.text('Native Plants for ' + state.zipCode, margin, y);
        y += 30;

        // Subtitle
        doc.setFont('helvetica', 'normal');
        doc.setFontSize(11);
        doc.setTextColor(100);
        doc.text(state.region.name + ' · ' + getSunLabel(state.sunLevel), margin, y);
        y += 25;

        doc.setTextColor(0);

        // Plants by category
        var grouped = groupByCategory(state.filteredPlants);
        var categoryOrder = ['canopy_tree', 'small_tree', 'tall_shrub', 'low_shrub', 'ground_cover'];

        categoryOrder.forEach(function(catKey) {
          if (!grouped[catKey] || grouped[catKey].length === 0) return;

          // Check if we need a new page
          if (y > 700) {
            doc.addPage();
            y = margin;
          }

          var category = PLANT_DATA.heightCategories[catKey];

          // Category header
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(14);
          doc.text(category.label + ' (' + category.range + ')', margin, y);
          y += 20;

          doc.setFont('helvetica', 'normal');
          doc.setFontSize(10);

          grouped[catKey].forEach(function(plant) {
            if (y > 720) {
              doc.addPage();
              y = margin;
            }

            // Plant name
            doc.setFont('helvetica', 'bold');
            doc.text(plant.commonName, margin, y);
            doc.setFont('helvetica', 'italic');
            doc.setTextColor(100);
            var nameWidth = doc.getTextWidth(plant.commonName + '  ');
            doc.text(plant.scientificName, margin + nameWidth, y);
            doc.setTextColor(0);
            y += 14;

            // Plant details
            doc.setFont('helvetica', 'normal');
            var details = formatHeight(plant.heightInches) + ' · ' +
                         PLANT_DATA.waterNeeds[plant.waterNeeds] + ' water · ' +
                         'Blooms ' + formatSeason(plant.bloomSeason);
            doc.text(details, margin, y);
            y += 12;

            // Ecological value
            var ecology = plant.ecologicalValue.map(function(v) {
              return PLANT_DATA.ecologicalIcons[v];
            }).join(', ');
            doc.setTextColor(100);
            doc.text('Supports: ' + ecology, margin, y);
            doc.setTextColor(0);
            y += 18;
          });

          y += 10;
        });

        // Nurseries section
        if (y > 650) {
          doc.addPage();
          y = margin;
        }

        doc.setFont('helvetica', 'bold');
        doc.setFontSize(14);
        doc.text('Where to Buy', margin, y);
        y += 20;

        doc.setFont('helvetica', 'normal');
        doc.setFontSize(10);

        PLANT_DATA.nurseries.forEach(function(nursery) {
          doc.setFont('helvetica', 'bold');
          doc.text(nursery.name, margin, y);
          y += 12;
          doc.setFont('helvetica', 'normal');
          doc.setTextColor(100);
          doc.text(nursery.address, margin, y);
          doc.setTextColor(0);
          y += 16;
        });

        // Footer
        var pageCount = doc.internal.getNumberOfPages();
        for (var i = 1; i <= pageCount; i++) {
          doc.setPage(i);
          doc.setFont('helvetica', 'normal');
          doc.setFontSize(8);
          doc.setTextColor(150);
          doc.text(
            'Generated by Native Plant Finder · bensiverly.com · Data: Calscape.org',
            margin,
            doc.internal.pageSize.getHeight() - 20
          );
        }

        // Save
        doc.save('native-plants-' + state.zipCode + '.pdf');
      }

      // ==========================================================================
      // Initialize
      // ==========================================================================
      sunValue.textContent = getSunLabel(state.sunLevel);

    })();
  </script>
</body>
</html>
